Please act as a Senior Front-End Developer with strong expertise in shadcn-vue, Framer Motion, and TailwindCSS.

Your task is to redesign the existing provided page to make it more creative, engaging, visually appealing, production-ready, and interactive — without altering any existing functionality.

The updated UI must be fully responsive, mobile-friendly and does not match with old Ui and layout it must be new look, maintaining a consistent color scheme and design language so future components align seamlessly with the overall style.

For reference, I’ve attached the current existing codebase. Focus solely on improving the user interface, not the logic or functionality.

Note : UI must be completely new look and layout without altering any existing functionality.

you can use vue lucide icon if you want to use it.

CHAT UI CODE :


<template>
    <AppLayout v-slot:default="slotProps">
        <div class="md:flex md:flex-grow md:overflow-hidden">
            <div class="md:w-[30%] md:flex flex-col h-full bg-white border-r border-l" :class="contact ? 'hidden' : ''">
                <ChatTable :rows="rows" :filters="props.filters" :rowCount="props.rowCount"
                    :ticketingIsEnabled="ticketingIsEnabled" :status="props?.status"
                    :chatSortDirection="props.chat_sort_direction" />
            </div>
            <div class="min-w-0 bg-cover flex flex-col chat-bg"
                :class="contact ? 'h-screen md:w-[70%]' : 'md:h-screen md:w-[70%]'">
                <ChatHeader v-if="contact" :ticketingIsEnabled="ticketingIsEnabled" :contact="contact"
                    :displayContactInfo="displayContactInfo" :ticket="ticket" :addon="addon"
                    @toggleView="toggleContactView" @deleteThread="deleteThread" @closeThread="closeThread" />
                <div v-if="contact && !displayTemplate" class="flex-1 overflow-y-auto" ref="scrollContainer2">
                    <ChatThread v-if="!displayContactInfo && !loadingThread && !displayTemplate" :contactId="contact.id"
                        :initialMessages="chatThread" :hasMoreMessages="hasMoreMessages" :initialNextPage="nextPage" />
                    <Contact v-if="displayContactInfo && !displayTemplate" class="bg-white h-full"
                        :fields="props.fields" :contact="contact" :locationSettings="props.locationSettings" />
                </div>
                <div v-if="contact && !displayContactInfo && !formLoading && !displayTemplate" class="w-full py-4">
                    <ChatForm :contact="contact" :simpleForm="simpleForm" :chatLimitReached="isChatLimitReached"
                        @viewTemplate="displayTemplate = true;" />
                </div>
                <div v-if="displayTemplate" class="flex-1 overflow-y-hidden">
                    <CampaignForm v-if="displayTemplate" class="bg-white h-full" :contact="contact.uuid"
                        :templates="templates" :contactGroups="[]" :settings="props.settings" :displayCancelBtn="false"
                        :displayTitle="true" :isCampaignFlow="false" :scheduleTemplate="false"
                        :sendText="'Send Message'" @viewTemplate="displayTemplate = false;" />
                </div>
            </div>
        </div>
        <button class="hidden" ref="toggleNavbarBtn" @click="slotProps.toggleNavBar"></button>
    </AppLayout>
</template>
<script setup>
import AppLayout from "./../Layout/App.vue";
import { default as axios } from 'axios';
import { ref, onMounted, watch } from 'vue';
import CampaignForm from '@/Components/CampaignForm.vue';
import ChatForm from '@/Components/ChatComponents/ChatForm.vue';
import ChatHeader from '@/Components/ChatComponents/ChatHeader.vue';
import ChatTable from '@/Components/ChatComponents/ChatTable.vue';
import ChatThread from '@/Components/ChatComponents/ChatThread.vue';
import Contact from '@/Components/ContactInfo.vue';
import { getEchoInstance } from '../../../echo';

const props = defineProps({
    rows: Array,
    rowCount: Number,
    pusherSettings: Object,
    organizationId: Number,
    isChatLimitReached: Boolean,
    toggleNavBar: Function,
    state: String,
    demoNumber: String,
    settings: Object,
    status: String,
    chatThread: Array,
    hasMoreMessages: Boolean,
    nextPage: Number,
    addon: Object,
    contact: Object,
    ticket: Object,
    chat_sort_direction: String,
    filters: Object,
    templates: Array,
    fields: Array,
    locationSettings: Object,
    simpleForm: Boolean
});

const rows = ref(props.rows);
const scrollContainer2 = ref(null);
const loadingThread = ref(false);
const displayContactInfo = ref(false);
const displayTemplate = ref(false);
const formLoading = ref(false);
const isChatLimitReached = ref(props.isChatLimitReached);
const toggleNavbarBtn = ref(null);
const config = ref(props.settings.metadata);
const settings = ref(config.value ? JSON.parse(config.value) : null);
const ticketingIsEnabled = ref(settings.value?.tickets?.active ?? false);
const chatThread = ref(props.chatThread);
const contact = ref(props.contact);

watch(() => props.rows, (newRows) => {
    rows.value = newRows;
});

function toggleContactView(value) {
    displayContactInfo.value = value;
}

const scrollToBottom = () => {
    const container = scrollContainer2.value;
    if (container) {
        container.scrollTo({
            top: container.scrollHeight,
            behavior: 'smooth',
        });
    }
};

const closeThread = () => {
    toggleNavbarBtn.value.click();
    contact.value = null;
}

const deleteThread = async () => {
    chatThread.value = [];
    await axios.delete('/chats/' + contact.value.uuid);
}

const updateChatThread = (chat) => {
    const wamId = chat[0].value.wam_id;
    const wamIdExists = chatThread.value.some(existingChat => existingChat[0].value.wam_id === wamId);

    if (!wamIdExists && chat[0].value.deleted_at == null) {
        chatThread.value.push(chat);
        setTimeout(scrollToBottom, 100);
    }
}

const updateSidePanel = async (chat) => {
    if (contact.value && contact.value.id == chat[0].value.contact_id) {
        updateChatThread(chat);
    }

    try {
        const response = await axios.get('/chats');
        if (response?.data?.result) {
            rows.value = response.data.result;
        }
    } catch (error) {
        console.error('Error updating side panel:', error);
    }
}

onMounted(() => {
    const echo = getEchoInstance(
        props.pusherSettings['pusher_app_key'],
        props.pusherSettings['pusher_app_cluster']
    );

    echo.channel('chats.ch' + props.organizationId)
        .listen('NewChatEvent', (event) => {
            updateSidePanel(event.chat);
        });

    scrollToBottom();
});
</script>

== CHILD COMPONENT UI CODE ===

CampaignForm Ui Code : 


<script setup>
    import axios from "axios";
    import FormInput from '@/Components/FormInput.vue';
    import FormSelect from '@/Components/FormSelect.vue';
    import WhatsappTemplate from '@/Components/WhatsappTemplate.vue';
    import { ref, computed, onMounted } from 'vue';
    import { Link, useForm } from "@inertiajs/vue3";
    import 'vue3-toastify/dist/index.css';
    import { trans } from 'laravel-vue-i18n';
    import Backup from './CrouselSend.vue';
    import FlowTemplate from './FlowTemplate.vue';

    const props = defineProps({
        templates: Object,
        contactGroups: Object,
        settings: Array,
        contact: {
            type: String,
            default: null
        },
        displayTitle: {
            type: Boolean,
            default: false
        },
        displayCancelBtn: {
            type: Boolean,
            default: true
        },
        isCampaignFlow: {
            type: Boolean,
            default: true
        },
        sendText: {
            type: String,
            default: 'Save'
        }
    });
    const isLoading = ref(false);
    const contactGroupOptions = ref([
        { value: 'all', label: trans('all contacts') },
    ]);
    const templateOptions = ref([]);
    const config = ref(props.settings?.metadata);
    const settings = ref(config.value ? JSON.parse(config.value) : null);
    const showModal = ref(true);
    const userChoice = ref(null);
    const sharedProps = computed(() => ({
    templates: props.templates,
    contactGroups: props.contactGroups,
    settings: props.settings,
    contact: props.contact,
    displayTitle: props.displayTitle,
    displayCancelBtn: props.displayCancelBtn,
    isCampaignFlow: props.isCampaignFlow,
    sendText: props.sendText,
    form,
    settingsParsed: settings.value,
    isLoading: isLoading.value,
    contactGroupOptions: contactGroupOptions.value,
    templateOptions: templateOptions.value,
    variableOptions: variableOptions.value,
    dynamicOptions: dynamicOptions.value,
    }));

const chooseOption = (option) => {
    userChoice.value = option;
    showModal.value = false;
};
    const variableOptions = ref([
        { value: 'static', label: trans('static') },
        { value: 'dynamic', label: trans('dynamic') }
    ]);

    const dynamicOptions = ref([
        { value: 'first name', label: trans('contact first name') },
        { value: 'last name', label: trans('contact last name') },
        { value: 'name', label: trans('contact full name') },
        { value: 'phone', label: trans('contact phone') },
        { value: 'email', label: trans('contact email') },
    ]);

    const form = useForm({
        name: null,
        template: null,
        contacts: null,
        time: null,
        skip_schedule: false,
        'header' : {
            'format' : null,
            'text' : null,
            'parameters' : []
        },
        'body' : {
            'text' : null,
            'parameters' : []
        },
        'footer' : {
            'text' : null,
        },
        'buttons' : [],
    });

    const loadTemplate = async() => {
                try {
            const response = await axios.get('/templates/' + form.template);
            if(response){
                const metadata = JSON.parse(response.data.metadata);
                form.header.format = extractComponent(metadata, 'HEADER', 'format');

                form.header.text = extractComponent(metadata, 'HEADER', 'text');
                const headerExamples = extractComponent(metadata, 'HEADER', 'example');
                if (headerExamples) {
                    if(form.header.format === 'TEXT'){
                        form.header.parameters = headerExamples.header_text.map(item => ({
                            type: 'text',
                            selection: 'static',
                            value: item,
                        }));
                    } else if(form.header.format === 'IMAGE' || form.header.format === 'DOCUMENT' || form.header.format === 'VIDEO'){
                        form.header.parameters = headerExamples.header_handle.map(item => ({
                            type: form.header.format,
                            selection: 'default',
                            value: null,
                            url: item,
                        }));
                    }
                } else {
                    form.header.parameters = [];
                }
                
                form.body.text = extractComponent(metadata, 'BODY', 'text');
                const bodyExamples = extractComponent(metadata, 'BODY', 'example');
                if (bodyExamples) {
                    form.body.parameters = bodyExamples.body_text[0].map(item => ({
                        type: 'text',
                        selection: 'static',
                        value: item,
                    }));
                } else {
                    form.body.parameters = [];
                }

                form.footer.text = extractComponent(metadata, 'FOOTER', 'text');

                const buttons = extractComponent(metadata, 'BUTTONS', 'buttons');
                if (buttons) {
                    form.buttons = buttons.map(item => ({
                        type: item.type,
                        text: item.text,
                        value: item[item.type.toLowerCase()] ?? null,
                        parameters: (item.type === 'QUICK_REPLY')
                            ? [{ type: 'static', value: null }]
                            : (item.example
                                ? item.example.map(param => ({ type: 'static', value: param }))
                                : []
                            ),
                    }));
                } else {
                    form.buttons = [];
                }

            }
        } catch (error) {
        }
    }

    const handleFileUpload = (event) => {
        const fileSizeLimit = getFileSizeLimit(form.header.parameters[0].type);
        const file = event.target.files[0];

        if (file && file.size > fileSizeLimit) {
            // Handle file size exceeding the limit
            alert(trans('file size exceeds the limit. Max allowed size:') + ' ' + fileSizeLimit + 'b');
            // Clear the file input
            event.target.value = null;
        } else {
            const reader = new FileReader();

            reader.onload = (e) => {
                form.header.parameters[0].url = e.target.result;
            };

            form.header.parameters[0].selection = 'upload';
            form.header.parameters[0].value = file;

            // Start reading the file
            reader.readAsDataURL(file);
        }
    }

    const getFileAcceptAttribute = (fileType) => {
        switch (fileType) {
            case 'IMAGE':
                return '.png, .jpg';
            case 'DOCUMENT':
                return '.pdf, .txt, .ppt, .doc, .xls, .docx, .pptx, .xlsx';
            case 'VIDEO':
                return '.mp4';
            default:
                return '';
        }
    }

    const getFileSizeLimit = (fileType) => {
        switch (fileType) {
            case 'IMAGE':
                return 5 * 1024 * 1024; // 5MB
            case 'DOCUMENT':
                return 100 * 1024 * 1024; // 100MB
            case 'VIDEO':
                return 16 * 1024 * 1024; // 16MB
            default:
                return Infinity;
        }
    }

    const extractComponent = (data, type, customProperty) => {
        const component = data.components.find(
            (c) => c.type === type
        );

        return component ? component[customProperty] : null;
    };

    const transformOptions = (options) => {
        return options.map((option) => ({
            value: option.uuid,
            label: option.language ? option.name + ' [' + option.language + ']' : option.name,
        }));
    };

    const submitForm = () => {
        isLoading.value = true;
        form.post(props.isCampaignFlow ? '/campaigns' : '/chat/' + props.contact + '/send/template', {
            onFinish: () => {
                isLoading.value = false;
                if(!props.isCampaignFlow){
                    emit('viewTemplate', false);
                }
            },
        });
    }

    const emit = defineEmits(['viewTemplate']);

    const viewTemplate = () => {
        emit('viewTemplate', false);
    }

    onMounted(() => {
  // Filter out templates starting with "carousel_" or "flow_"
  const filteredTemplates = props.templates.filter(template =>
    !template.name?.startsWith('crousel_') && !template.name?.startsWith('flow_')
  );

  templateOptions.value = transformOptions(filteredTemplates);

  contactGroupOptions.value = [
    ...contactGroupOptions.value,
    ...transformOptions(props.contactGroups)
  ];
});


</script>
<template>
  <!-- Modal -->
  <div v-if="showModal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white rounded-2xl shadow-2xl p-6 w-[60%] max-w-md text-center">
    <h2 class="text-xl font-semibold mb-6 text-gray-800">Choose an Option</h2>

    <div class="flex flex-col gap-4">
      <button
        @click="chooseOption('template')"
        class="w-full text-white py-2 rounded-xl transition-all duration-200"
        style="background-color: #ff5200;"
      >
        Template
      </button>

      <button
        @click="chooseOption('carousel')"
        class="w-full text-white py-2 rounded-xl transition-all duration-200"
        style="background-color: #ff5200;"
      >
        Carousel
      </button>

      <button
        @click="chooseOption('flow')"
        class="w-full text-white py-2 rounded-xl transition-all duration-200"
        style="background-color: #ff5200;"
      >
        Flow
      </button>
    </div>
  </div>
</div>


<component
  v-if="userChoice === 'flow'"
  :is="FlowTemplate"
  v-bind="sharedProps"
/>
  <component
    v-else
    :is="userChoice === 'carousel' ? Backup : 'div'"
    v-bind="sharedProps"
  >
  
    <template v-if="userChoice === 'template'">
        <div class="pb-100px">
        <div :class="'md:flex px md:flex-grow-1'">
        <div v-if="!settings?.whatsapp" class="md:w-[50%] p-4 md:p-8 overflow-y-auto h-[90vh]">
            <div class="bg-slate-50 border border-primary shadow rounded-md p-4 py-8">
                <div class="flex justify-center mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="72" height="72" viewBox="0 0 48 48"><path fill="black" d="M43.634 4.366a1.25 1.25 0 0 1 0 1.768l-4.913 4.913a9.253 9.253 0 0 1-.744 12.244l-3.343 3.343a1.25 1.25 0 0 1-1.768 0l-11.5-11.5a1.25 1.25 0 0 1 0-1.768l3.343-3.343a9.25 9.25 0 0 1 12.244-.743l4.913-4.914a1.25 1.25 0 0 1 1.768 0m-7.611 7.425a6.75 6.75 0 0 0-9.546 0l-2.46 2.459l9.733 9.732l2.46-2.459a6.75 6.75 0 0 0 0-9.546zM9.28 36.953l-4.914 4.913a1.25 1.25 0 0 0 1.768 1.768l4.913-4.913a9.253 9.253 0 0 0 12.244-.744l3.343-3.343a1.25 1.25 0 0 0 0-1.768L25.268 31.5l3.366-3.366a1.25 1.25 0 0 0-1.768-1.768L23.5 29.732L18.268 24.5l3.366-3.366a1.25 1.25 0 0 0-1.768-1.768L16.5 22.732l-1.366-1.366a1.25 1.25 0 0 0-1.768 0l-3.343 3.343a9.25 9.25 0 0 0-.743 12.244m2.51-10.476l2.46-2.46l9.732 9.733l-2.459 2.46a6.75 6.75 0 0 1-9.546 0l-.186-.187a6.75 6.75 0 0 1 0-9.546"/></svg>
                </div>
                <h3 class="text-center text-lg font-medium mb-4">{{ $t('Connect your whatsapp account') }}</h3>
                <h4 class="text-center mb-4">{{ $t('You need to connect your WhatsApp account first before you can send out campaigns.') }}</h4>
                <div class="flex justify-center">
                    <Link href="/settings/whatsapp" class="rounded-md px-3 py-2 text-sm hover:shadow-md text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 bg-primary" :disabled="isLoading">
                        <span v-if="!isLoading">{{ $t('Connect Whatsapp account') }}</span>
                    </Link>
                </div>
            </div>
        </div>

        <form v-else @submit.prevent="submitForm()" class="overflow-y-auto md:w-[50%]" :class="isCampaignFlow ? 'p-4 md:p-8 h-[90vh]' : ' h-full'">
            <div v-if="displayTitle" class="m-1 rounded px-3 pt-3 pb-3 bg-slate-100 flex items-center justify-between mb-4">
                <h3 class="text-[15px]">{{ $t('Send Template Message') }}</h3>
                <button @click="viewTemplate()" class="text-sm md:inline-flex hidden justify-center rounded-md border border-transparent bg-red-800 px-4 py-1 text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2">Cancel</button>
            </div>
            <div class="grid gap-x-6 gap-y-4 mb-8 px-3 pb-60" :class="isCampaignFlow ? 'sm:grid-cols-6' : ''">
                <FormInput v-if="isCampaignFlow" v-model="form.name" :name="$t('Campaign name')" :type="'text'" :error="form.errors.name" :required="true" :class="'sm:col-span-6'"/>
                <FormSelect v-model="form.template" @update:modelValue="loadTemplate" :options="templateOptions" :required="true" :error="form.errors.template" :name="$t('Template')" :class="'sm:col-span-3'" :placeholder="$t('Select template')"/>
                <FormSelect v-if="isCampaignFlow" v-model="form.contacts" :options="contactGroupOptions" :name="$t('Send to')" :required="true" :class="'sm:col-span-3'" :placeholder="$t('Select contacts')" :error="form.errors.contacts"/>
                <FormInput v-if="isCampaignFlow && !form.skip_schedule" v-model="form.time" :name="$t('Scheduled time')" :type="'datetime-local'" :error="form.errors.time" :required="true" :class="'sm:col-span-6'"/>
                <div v-if="isCampaignFlow" class="relative flex gap-x-3 sm:col-span-6">
                    <div class="flex h-6 items-center">
                        <input v-model="form.skip_schedule" id="skip-schedule" name="skip-schedule" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600">
                    </div>
                    <div class="text-sm leading-6">
                        <label for="skip-schedule" class="font-medium text-gray-900">{{ $t('Skip scheduling & send immediately') }}</label>
                    </div>
                </div>
            </div>
            <div :class="isCampaignFlow ? '' : 'px-3 md:px-3'">
                <div v-if="form.header.parameters.length > 0" class="bg-slate-100 p-3 mt-4 text-sm">
                    <h2 class="flex items-center justify-between space-x-2 pb-2 border-b">
                        <div class="flex items-center space-x-2">
                            <span>{{ $t('Header variables') }}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296c-44.096 0-108.992 44.736-148.48 101.504c0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04c67.84 0 107.904-43.648 147.456-100.416z"/></svg>
                        </div>
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M6.102 16.98c-1.074 0-1.648-1.264-.94-2.073l5.521-6.31a1.75 1.75 0 0 1 2.634 0l5.522 6.31c.707.809.133 2.073-.94 2.073H6.101Z"/></svg>
                        </span>
                    </h2>
                    <div v-for="(item, index) in form.header.parameters" :key="index" class="mt-2 flex items-center space-x-4">
                        <div v-if="form.header.parameters[index].type === 'text'" class="w-full">
                            <FormSelect v-model="form.header.parameters[index].selection" :name="$t('Content type')" :options="variableOptions" :class="'sm:col-span-6'"/>
                        </div>
                        <div v-if="form.header.parameters[index].type === 'text'" class="w-full">
                            <FormInput v-if="form.header.parameters[index].selection === 'static'" :name="$t('Value')" :required="true" :error="form.errors['header.parameters.0.value']" v-model="form.header.parameters[index].value" :type="'text'" :class="'sm:col-span-6'"/>
                            <FormSelect v-if="form.header.parameters[index].selection === 'dynamic'" :name="$t('Value')" :required="true" :error="form.errors['header.parameters.0.value']" v-model="form.header.parameters[index].value" :options="dynamicOptions" :class="'sm:col-span-6'"/>
                        </div>
                        <div v-if="['IMAGE', 'DOCUMENT', 'VIDEO'].includes(form.header.parameters[index].type)" class="w-full mt-3">
                            <div>
                                <div class="flex items-center space-x-4">
                                    <label class="cursor-pointer flex justify-center px-2 py-2 w-[30%] bg-slate-200 shadow-sm rounded-lg border" 
                                        :class="form.errors['header.parameters.0.value'] ? 'border border-red-700' : ''" for="file-upload">
                                        {{ $t('Upload') }}
                                    </label>
                                    <input type="file" class="sr-only" :accept="getFileAcceptAttribute(form.header.parameters[index].type)" ref="fileInput" id="file-upload" @change="handleFileUpload"/>
                                    <div v-if="form.header.parameters[index].value" class="w-[20em] truncate">{{ form.header.parameters[index].selection === 'default' ? form.header.parameters[index].value : form.header.parameters[index].value.name }}</div>
                                    <span v-else>{{ $t('No file chosen') }}</span>
                                </div>
                                <p v-if="form.header.parameters[index].type === 'IMAGE'" class="text-left text-xs mt-2">{{ $t('Max file upload size is') }} <b>5MB</b> <br> {{ $t('Supported file extensions') }}: .png, jpg</p>
                                <p v-if="form.header.parameters[index].type === 'DOCUMENT'" class="text-left text-xs mt-2">{{ $t('Max file upload size is') }} <b>100MB</b> <br> {{ $t('Supported file extensions') }}: .pdf, .txt, .ppt, .doc, .xls, .docx, .pptx, .xlsx</p>
                                <p v-if="form.header.parameters[index].type === 'VIDEO'" class="text-left text-xs mt-2">{{ $t('Max file upload size is') }} <b>16MB</b> <br> {{ $t('Supported file extensions') }}: .mp4</p>
                            </div>
                            
                            <div v-if="form.errors['header.parameters.0.value']" class="form-error text-[#b91c1c] text-xs">{{ form.errors['header.parameters.0.value'] }}</div>
                        </div>
                    </div>
                </div>
                <div v-if="form.body.parameters.length > 0" class="bg-slate-100 p-3 mt-1 text-sm">
                    <h2 class="flex items-center justify-between space-x-2 pb-2 border-b">
                        <div class="flex items-center space-x-2">
                            <span>{{ $t('Body variables') }}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296c-44.096 0-108.992 44.736-148.48 101.504c0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04c67.84 0 107.904-43.648 147.456-100.416z"/></svg>
                        </div>
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M6.102 16.98c-1.074 0-1.648-1.264-.94-2.073l5.521-6.31a1.75 1.75 0 0 1 2.634 0l5.522 6.31c.707.809.133 2.073-.94 2.073H6.101Z"/></svg>
                        </span>
                    </h2>
                    <div v-for="(item, index) in form.body.parameters" :key="index" class="mt-2 flex items-center space-x-4">
                        <div class="w-[30%]">
                            <span v-text="'{{' + (index + 1) + '}}'"></span>
                        </div>
                        <div class="w-full">
                            <FormSelect v-model="form.body.parameters[index].selection" :options="variableOptions" :class="'sm:col-span-6'"/>
                        </div>
                        <div class="w-full">
                            <FormInput v-if="form.body.parameters[index].selection === 'static'" v-model="form.body.parameters[index].value" :required="true" :error="form.errors['body.parameters.0.value']" :type="'text'" :class="'sm:col-span-6'"/>
                            <FormSelect v-if="form.body.parameters[index].selection === 'dynamic'" v-model="form.body.parameters[index].value" :required="true" :error="form.errors['body.parameters.0.value']" :options="dynamicOptions" :class="'sm:col-span-6'"/>
                        </div>
                    </div>
                </div>
                <div v-if="form.buttons.length > 0" class="bg-slate-100 p-3 mt-1 text-sm">
                    <h2 class="flex items-center justify-between space-x-2 pb-2 border-b">
                        <div class="flex items-center space-x-2">
                            <span>{{ $t('Button variables') }}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296c-44.096 0-108.992 44.736-148.48 101.504c0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04c67.84 0 107.904-43.648 147.456-100.416z"/></svg>
                        </div>
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M6.102 16.98c-1.074 0-1.648-1.264-.94-2.073l5.521-6.31a1.75 1.75 0 0 1 2.634 0l5.522 6.31c.707.809.133 2.073-.94 2.073H6.101Z"/></svg>
                        </span>
                    </h2>
                    <div v-for="(item, index) in form.buttons" :key="index">
                        <div v-if="item.parameters.length > 0" class="mt-4 bg-slate-50 p-3">
                            <div class="w-[100%] mb-1">
                                <span>{{ $t('Label') }}: {{ item.text }}</span>
                            </div>
                            <div v-for="(value, key) in item.parameters" :key="key" class="flex items-center space-x-4">
                                <div class="w-full">
                                    <FormSelect v-model="value.type" :name="$t('Button type')" :options="variableOptions" :class="'sm:col-span-6'"/>
                                </div>
                                <div class="w-full">
                                    <FormInput v-if="value.type === 'static'" v-model="value.value" :name="$t('Value')" :required="true" :error="form.errors['buttons.'+ index +'.parameters.0.value']" :type="'text'" :class="'sm:col-span-6'"/>
                                    <FormSelect v-if="value.type === 'dynamic'" v-model="value.value" :name="$t('Value')" :required="true" :error="form.errors['buttons.'+ index +'.parameters.0.value']" :options="dynamicOptions" :class="'sm:col-span-6'"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-end space-x-3 mt-3">
                    <div v-if="displayCancelBtn">
                        <Link href="/campaigns" class="block rounded-md px-3 py-2 text-sm text-gray-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 bg-slate-200">
                            {{ $t('Cancel') }}
                        </Link>
                    </div>
                    <div class="pb-100">
                        <button type="submit" class="rounded-md px-3 py-2 text-sm text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 bg-primary" :disabled="isLoading">
                            <span v-if="!isLoading">{{ sendText ? sendText : $t('Save') }}</span>
                            <svg v-else xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2A10 10 0 1 0 22 12A10 10 0 0 0 12 2Zm0 18a8 8 0 1 1 8-8A8 8 0 0 1 12 20Z" opacity=".5"/><path fill="currentColor" d="M20 12h2A10 10 0 0 0 12 2V4A8 8 0 0 1 20 12Z"><animateTransform attributeName="transform" dur="1s" from="0 12 12" repeatCount="indefinite" to="360 12 12" type="rotate"/></path></svg>
                        </button>
                    </div>
                </div>
            </div>
        </form>
        <div class="md:w-[50%] py-20 flex justify-center chat-bg" :class="isCampaignFlow ? 'px-20' : 'px-10'">
            <div>
                <WhatsappTemplate :parameters="form" :visible="form.template ? true : false"/>
            </div>
        </div>
        </div>
    </div>
    </template>
  </component>
</template>


WhatsappTemplate Ui Code :

<script setup>
    import { ref } from 'vue';

    const props = defineProps({
        placeholder: {
            type: Boolean,
            default: true
        },
        parameters: {
            type: Object,
            default: null
        },
        visible: Boolean,
    })

    const formatText = (text) => {
        if (text === null || text === undefined) {
            return '';
        }

        return text.replace(/\n/g, '<br>');
    };

    const getExtension = (fileUrl) => {
        // Extract the file extension from the URL
        const extension = fileUrl.split('.').pop().toUpperCase();

        // Define a set of known extensions
        const knownExtensions = ['TXT', 'PDF', 'PPT', 'DOC', 'XLS', 'DOCX', 'PPTX', 'XLSX'];

        // Return the extension if it is known, otherwise return 'Unknown'
        return knownExtensions.includes(extension) ? extension : 'Unknown';
    };

    const downloading = ref(false);

    const downloadClicked = () => {
        downloading.value = true;
        setTimeout(() => {
            downloading.value = false;
        }, 2000);
    };
</script>
<template>
    <div v-if="visible" class="mr-auto rounded-lg rounded-tl-none my-[0.1em] p-1 text-sm bg-white flex flex-col relative speech-bubble-left max-w-[25em]">
        <div v-if="parameters.header.format != null && parameters.header.format != 'TEXT'">
            <div v-if="placeholder == true" class="bg-[#ccd0d5] mb-4 flex justify-center rounded py-8">
                <img v-if="parameters.header.format === 'IMAGE'" :src="'/images/image-placeholder.png'">
                <img v-if="parameters.header.format === 'VIDEO'" :src="'/images/video-placeholder.png'">
                <img v-if="parameters.header.format === 'DOCUMENT'" :src="'/images/document-placeholder.png'">
            </div>
            <div v-else class="mb-4 flex justify-center rounded">
                <div v-if="parameters.header.format === 'IMAGE'" class="relative w-full h-full">
                    <img :src="parameters.header.parameters[0].value" alt="Image" class="rounded-md flex justify-center items-center z-1 w-full h-full" />
                </div>
                <video v-if="parameters.header.format === 'VIDEO'" controls width="300" class="max-h-[350px]">
                    <source :src="parameters.header.parameters[0].value" type="video/mp4">
                </video>
                <div v-if="parameters.header.format === 'DOCUMENT'">
                    <div class="relative">
                        <div class="flex space-x-2 w-full h-1/3 bg-white opacity-90 pt-2">
                            <div>
                                <svg v-if="getExtension(parameters.header.parameters[0].value) === 'PDF'" xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 1024 1024"><path fill="red" d="m531.3 574.4l.3-1.4c5.8-23.9 13.1-53.7 7.4-80.7c-3.8-21.3-19.5-29.6-32.9-30.2c-15.8-.7-29.9 8.3-33.4 21.4c-6.6 24-.7 56.8 10.1 98.6c-13.6 32.4-35.3 79.5-51.2 107.5c-29.6 15.3-69.3 38.9-75.2 68.7c-1.2 5.5.2 12.5 3.5 18.8c3.7 7 9.6 12.4 16.5 15c3 1.1 6.6 2 10.8 2c17.6 0 46.1-14.2 84.1-79.4c5.8-1.9 11.8-3.9 17.6-5.9c27.2-9.2 55.4-18.8 80.9-23.1c28.2 15.1 60.3 24.8 82.1 24.8c21.6 0 30.1-12.8 33.3-20.5c5.6-13.5 2.9-30.5-6.2-39.6c-13.2-13-45.3-16.4-95.3-10.2c-24.6-15-40.7-35.4-52.4-65.8zM421.6 726.3c-13.9 20.2-24.4 30.3-30.1 34.7c6.7-12.3 19.8-25.3 30.1-34.7zm87.6-235.5c5.2 8.9 4.5 35.8.5 49.4c-4.9-19.9-5.6-48.1-2.7-51.4c.8.1 1.5.7 2.2 2zm-1.6 120.5c10.7 18.5 24.2 34.4 39.1 46.2c-21.6 4.9-41.3 13-58.9 20.2c-4.2 1.7-8.3 3.4-12.3 5c13.3-24.1 24.4-51.4 32.1-71.4zm155.6 65.5c.1.2.2.5-.4.9h-.2l-.2.3c-.8.5-9 5.3-44.3-8.6c40.6-1.9 45 7.3 45.1 7.4zm191.4-388.2L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0 0 42 42h216v494z"/></svg>
                                <svg v-if="getExtension(parameters.header.parameters[0].value) === 'XLSX' || getExtension(parameters.header.parameters[0].value) === 'XLS'" xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 32 32"><defs><linearGradient id="vscodeIconsFileTypeExcel0" x1="4.494" x2="13.832" y1="-2092.086" y2="-2075.914" gradientTransform="translate(0 2100)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#18884f"/><stop offset=".5" stop-color="#117e43"/><stop offset="1" stop-color="#0b6631"/></linearGradient></defs><path fill="#185c37" d="M19.581 15.35L8.512 13.4v14.409A1.192 1.192 0 0 0 9.705 29h19.1A1.192 1.192 0 0 0 30 27.809V22.5Z"/><path fill="#21a366" d="M19.581 3H9.705a1.192 1.192 0 0 0-1.193 1.191V9.5L19.581 16l5.861 1.95L30 16V9.5Z"/><path fill="#107c41" d="M8.512 9.5h11.069V16H8.512Z"/><path d="M16.434 8.2H8.512v16.25h7.922a1.2 1.2 0 0 0 1.194-1.191V9.391A1.2 1.2 0 0 0 16.434 8.2Z" opacity=".1"/><path d="M15.783 8.85H8.512V25.1h7.271a1.2 1.2 0 0 0 1.194-1.191V10.041a1.2 1.2 0 0 0-1.194-1.191Z" opacity=".2"/><path d="M15.783 8.85H8.512V23.8h7.271a1.2 1.2 0 0 0 1.194-1.191V10.041a1.2 1.2 0 0 0-1.194-1.191Z" opacity=".2"/><path d="M15.132 8.85h-6.62V23.8h6.62a1.2 1.2 0 0 0 1.194-1.191V10.041a1.2 1.2 0 0 0-1.194-1.191Z" opacity=".2"/><path fill="url(#vscodeIconsFileTypeExcel0)" d="M3.194 8.85h11.938a1.193 1.193 0 0 1 1.194 1.191v11.918a1.193 1.193 0 0 1-1.194 1.191H3.194A1.192 1.192 0 0 1 2 21.959V10.041A1.192 1.192 0 0 1 3.194 8.85Z"/><path fill="#fff" d="m5.7 19.873l2.511-3.884l-2.3-3.862h1.847L9.013 14.6c.116.234.2.408.238.524h.017c.082-.188.169-.369.26-.546l1.342-2.447h1.7l-2.359 3.84l2.419 3.905h-1.809l-1.45-2.711A2.355 2.355 0 0 1 9.2 16.8h-.024a1.688 1.688 0 0 1-.168.351l-1.493 2.722Z"/><path fill="#33c481" d="M28.806 3h-9.225v6.5H30V4.191A1.192 1.192 0 0 0 28.806 3Z"/><path fill="#107c41" d="M19.581 16H30v6.5H19.581Z"/></svg>
                                <svg v-if="getExtension(parameters.header.parameters[0].value) === 'DOC' || getExtension(parameters.header.parameters[0].value) === 'DOCX'" xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 32 32"><defs><linearGradient id="vscodeIconsFileTypeWord0" x1="4.494" x2="13.832" y1="-1712.086" y2="-1695.914" gradientTransform="translate(0 1720)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#2368c4"/><stop offset=".5" stop-color="#1a5dbe"/><stop offset="1" stop-color="#1146ac"/></linearGradient></defs><path fill="#41a5ee" d="M28.806 3H9.705a1.192 1.192 0 0 0-1.193 1.191V9.5l11.069 3.25L30 9.5V4.191A1.192 1.192 0 0 0 28.806 3Z"/><path fill="#2b7cd3" d="M30 9.5H8.512V16l11.069 1.95L30 16Z"/><path fill="#185abd" d="M8.512 16v6.5l10.418 1.3L30 22.5V16Z"/><path fill="#103f91" d="M9.705 29h19.1A1.192 1.192 0 0 0 30 27.809V22.5H8.512v5.309A1.192 1.192 0 0 0 9.705 29Z"/><path d="M16.434 8.2H8.512v16.25h7.922a1.2 1.2 0 0 0 1.194-1.191V9.391A1.2 1.2 0 0 0 16.434 8.2Z" opacity=".1"/><path d="M15.783 8.85H8.512V25.1h7.271a1.2 1.2 0 0 0 1.194-1.191V10.041a1.2 1.2 0 0 0-1.194-1.191Z" opacity=".2"/><path d="M15.783 8.85H8.512V23.8h7.271a1.2 1.2 0 0 0 1.194-1.191V10.041a1.2 1.2 0 0 0-1.194-1.191Z" opacity=".2"/><path d="M15.132 8.85h-6.62V23.8h6.62a1.2 1.2 0 0 0 1.194-1.191V10.041a1.2 1.2 0 0 0-1.194-1.191Z" opacity=".2"/><path fill="url(#vscodeIconsFileTypeWord0)" d="M3.194 8.85h11.938a1.193 1.193 0 0 1 1.194 1.191v11.918a1.193 1.193 0 0 1-1.194 1.191H3.194A1.192 1.192 0 0 1 2 21.959V10.041A1.192 1.192 0 0 1 3.194 8.85Z"/><path fill="#fff" d="M6.9 17.988c.023.184.039.344.046.481h.028c.01-.13.032-.287.065-.47s.062-.338.089-.465l1.255-5.407h1.624l1.3 5.326a7.761 7.761 0 0 1 .162 1h.022a7.6 7.6 0 0 1 .135-.975l1.039-5.358h1.477l-1.824 7.748h-1.727l-1.237-5.126q-.054-.222-.122-.578t-.084-.52h-.021q-.021.189-.084.561c-.042.249-.075.432-.1.552L7.78 19.871H6.024L4.19 12.127h1.5l1.131 5.418a4.469 4.469 0 0 1 .079.443Z"/></svg>
                                <svg v-if="getExtension(parameters.header.parameters[0].value) === 'PPT' || getExtension(parameters.header.parameters[0].value) === 'PPTX'" xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 32 32"><defs><linearGradient id="vscodeIconsFileTypePowerpoint0" x1="4.494" x2="13.832" y1="-1748.086" y2="-1731.914" gradientTransform="translate(0 1756)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ca4c28"/><stop offset=".5" stop-color="#c5401e"/><stop offset="1" stop-color="#b62f14"/></linearGradient></defs><path fill="#ed6c47" d="M18.93 17.3L16.977 3h-.146A12.9 12.9 0 0 0 3.953 15.854V16Z"/><path fill="#ff8f6b" d="M17.123 3h-.146v13l6.511 2.6L30 16v-.146A12.9 12.9 0 0 0 17.123 3Z"/><path fill="#d35230" d="M30 16v.143A12.905 12.905 0 0 1 17.12 29h-.287a12.907 12.907 0 0 1-12.88-12.857V16Z"/><path d="M17.628 9.389V23.26a1.2 1.2 0 0 1-.742 1.1a1.16 1.16 0 0 1-.45.091H7.027a10.08 10.08 0 0 1-.521-.65a12.735 12.735 0 0 1-2.553-7.657v-.286A12.705 12.705 0 0 1 6.05 8.85a8.82 8.82 0 0 1 .456-.65h9.93a1.2 1.2 0 0 1 1.192 1.189Z" opacity=".1"/><path d="M16.977 10.04v13.871a1.15 1.15 0 0 1-.091.448a1.2 1.2 0 0 1-1.1.741H7.62q-.309-.314-.593-.65a10.08 10.08 0 0 1-.521-.65a12.735 12.735 0 0 1-2.553-7.657v-.286A12.705 12.705 0 0 1 6.05 8.85h9.735a1.2 1.2 0 0 1 1.192 1.19Z" opacity=".2"/><path d="M16.977 10.04v12.571a1.2 1.2 0 0 1-1.192 1.189H6.506a12.735 12.735 0 0 1-2.553-7.657v-.286A12.705 12.705 0 0 1 6.05 8.85h9.735a1.2 1.2 0 0 1 1.192 1.19Z" opacity=".2"/><path d="M16.326 10.04v12.571a1.2 1.2 0 0 1-1.192 1.189H6.506a12.735 12.735 0 0 1-2.553-7.657v-.286A12.705 12.705 0 0 1 6.05 8.85h9.084a1.2 1.2 0 0 1 1.192 1.19Z" opacity=".2"/><path fill="url(#vscodeIconsFileTypePowerpoint0)" d="M3.194 8.85h11.938a1.193 1.193 0 0 1 1.194 1.191v11.918a1.193 1.193 0 0 1-1.194 1.191H3.194A1.192 1.192 0 0 1 2 21.959V10.041A1.192 1.192 0 0 1 3.194 8.85Z"/><path fill="#fff" d="M9.293 12.028a3.287 3.287 0 0 1 2.174.636a2.27 2.27 0 0 1 .756 1.841a2.555 2.555 0 0 1-.373 1.376a2.49 2.49 0 0 1-1.059.935a3.607 3.607 0 0 1-1.591.334H7.687v2.8H6.141v-7.922ZM7.686 15.94h1.331a1.735 1.735 0 0 0 1.177-.351a1.3 1.3 0 0 0 .4-1.025q0-1.309-1.525-1.31H7.686v2.686Z"/></svg>
                                <svg v-if="getExtension(parameters.header.parameters[0].value) === 'TXT'" xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 16 16"><path fill="black" fill-rule="evenodd" d="M14 4.5V14a2 2 0 0 1-2 2h-2v-1h2a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM1.928 15.849v-3.337h1.136v-.662H0v.662h1.134v3.337zm4.689-3.999h-.894L4.9 13.289h-.035l-.832-1.439h-.932l1.228 1.983l-1.24 2.016h.862l.853-1.415h.035l.85 1.415h.907l-1.253-1.992zm1.93.662v3.337h-.794v-3.337H6.619v-.662h3.064v.662H8.546Z"/></svg>
                            </div>
                            <div>
                                <div>
                                    <p class="overflow-ellipsis overflow-hidden line-clamp-2 w-[200px]">{{ $t('Document') }}</p>
                                </div>
                                <div class="flex items-center text-slate-500 text-[11px]">
                                    <span>{{ getExtension(parameters.header.parameters[0].value) }}</span>
                                </div>
                            </div>
                            <a :href="parameters.header.parameters[0].value" @click="downloadClicked" class="flex justify-end w-full">
                                <svg v-if="!downloading" xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path fill="currentColor" d="M4.025 11.975q0 2.825 1.725 5t4.4 2.825q.375.1.6.425t.225.725q0 .4-.275.663t-.625.187q-3.5-.7-5.775-3.437t-2.275-6.388q0-3.65 2.288-6.387T10.1 2.15q.35-.075.625.188T11 3q0 .4-.225.725t-.6.425q-2.7.65-4.425 2.825t-1.725 5Zm8.95 1.15l1.85-1.85q.3-.3.725-.3t.725.3q.3.3.288.725t-.313.725L12.675 16.3q-.3.3-.7.3t-.7-.3L7.65 12.65q-.3-.3-.288-.713t.313-.712q.3-.3.713-.3t.712.3l1.875 1.9V8q0-.425.288-.713T11.975 7q.425 0 .713.288t.287.712v5.125Zm3.05 5.75q.375-.225.813-.2t.762.35q.3.3.25.713t-.4.637q-.8.5-1.675.863t-1.8.562q-.4.075-.7-.175t-.3-.675q0-.425.263-.75t.687-.45q.55-.15 1.075-.375t1.025-.5ZM13.975 4.2q-.425-.125-.7-.45T13 3q0-.425.288-.675t.687-.175q.95.2 1.838.562T17.5 3.6q.35.225.375.625t-.25.7q-.3.325-.738.35t-.812-.2q-.5-.275-1.025-.5T13.975 4.2Zm5.75 9.75q.125-.425.463-.7t.762-.275q.425 0 .688.325t.162.725q-.2.95-.575 1.812t-.9 1.663q-.225.35-.625.35t-.675-.275q-.3-.3-.337-.725t.187-.8q.275-.5.488-1.012t.362-1.088Zm-.85-6.075q-.225-.375-.188-.788t.338-.712q.275-.275.675-.263t.625.338q.55.8.925 1.688t.575 1.837q.075.4-.187.7t-.688.3q-.425 0-.762-.287t-.463-.713q-.15-.55-.363-1.075t-.487-1.025Z"/></svg>
                                <svg v-else xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="2 4" stroke-dashoffset="6" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21"><animate attributeName="stroke-dashoffset" dur="0.6s" repeatCount="indefinite" values="6;0"/></path><path stroke-dasharray="30" stroke-dashoffset="30" d="M12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.1s" dur="0.3s" values="30;0"/></path><path stroke-dasharray="10" stroke-dashoffset="10" d="M12 8v7.5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.5s" dur="0.2s" values="10;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 15.5l3.5 -3.5M12 15.5l-3.5 -3.5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.7s" dur="0.2s" values="6;0"/></path></g></svg>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <h2 v-else class="text-gray-700 text-[16px] mb-1 px-2">{{ parameters.header.text }}</h2>
        <p class="px-2" v-html="formatText(parameters.body.text)"></p>
        <div class="text-[#8c8c8c] mt-1 px-2">
            <span class="text-[13px]">{{ parameters.footer.text }}</span>
            <span class="text-right text-xs leading-none float-right" :class="parameters.footer.text ? 'mt-2' : ''">9:15</span>
        </div>
    </div>
    <div v-if="parameters?.buttons?.length > 0" class="mr-auto text-sm text-[#00a5f4] flex flex-col relative max-w-[25em]">
        <div v-for="(item, index) in parameters.buttons" :key="index" class="flex justify-center items-center space-x-2 rounded-lg bg-white h-10 my-[0.1em]">
            <span>
                <svg v-if="item.type === 'COPY_CODE'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M19 21H8V7h11m0-2H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2m-3-4H4a2 2 0 0 0-2 2v14h2V3h12V1Z"/></svg>
                <svg v-else-if="item.type === 'PHONE_NUMBER'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><g fill="none"><path fill="currentColor" d="M20 16v4c-2.758 0-5.07-.495-7-1.325c-3.841-1.652-6.176-4.63-7.5-7.675C4.4 8.472 4 5.898 4 4h4l1 4l-3.5 3c1.324 3.045 3.659 6.023 7.5 7.675L16 15l4 1z"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 18.675c1.93.83 4.242 1.325 7 1.325v-4l-4-1l-3 3.675zm0 0C9.159 17.023 6.824 14.045 5.5 11m0 0C4.4 8.472 4 5.898 4 4h4l1 4l-3.5 3z"/></g></svg>
                <img v-else-if="item.type === 'URL'" :src="'/images/icons/link.png'" class="h-4">
                <img v-else :src="'/images/icons/reply.png'" class="h-4">
            </span>
            <span>{{ item.text }}</span>
        </div>
    </div>
</template>

CrouselSend Ui Code :

<script setup>
import axios from "axios";
import FormInput from "@/Components/FormInput.vue";
import FormSelect from "@/Components/FormSelect.vue";
import WhatsappTemplate from "@/Components/WhatsappTemplate.vue";
import { ref, onMounted } from "vue";
import { Link, useForm } from "@inertiajs/vue3";
import "vue3-toastify/dist/index.css";
import { trans } from "laravel-vue-i18n";
import { router } from "@inertiajs/vue3";
  
const props = defineProps({
  templates: Object,
  contactGroups: Object,
  settings: Array,
  contact: {
    type: String,
    default: null,
  },
  displayTitle: {
    type: Boolean,
    default: false,
  },
  displayCancelBtn: {
    type: Boolean,
    default: true,
  },
  isCampaignFlow: {
    type: Boolean,
    default: true,
  },
  sendText: {
    type: String,
    default: "Save",
  },

  // ✅ Additional props passed from CampaignForm.vue
  form: Object,
  settingsParsed: Object,
  isLoading: Boolean,
  contactGroupOptions: Array,
  templateOptions: Array,
  variableOptions: Array,
  dynamicOptions: Array,
});

const isTempLoading = ref(false);
const isLoading = ref(false);

const contactGroupOptions = ref([
  { value: "all", label: trans("all contacts") },
]);
const templateOptions = ref([]);
const config = ref(props.settings?.metadata);
const settings = ref(config.value ? JSON.parse(config.value) : null);

const variableOptions = ref([
  { value: "static", label: trans("static") },
  { value: "dynamic", label: trans("dynamic") },
]);

const dynamicOptions = ref([
  { value: "first name", label: trans("contact first name") },
  { value: "last name", label: trans("contact last name") },
  { value: "name", label: trans("contact full name") },
  { value: "phone", label: trans("contact phone") },
  { value: "email", label: trans("contact email") },
]);

const form = useForm({
  name: null,
  template: null,
  contacts: null,
  time: null,
  skip_schedule: false,
  header: {
    format: null,
    text: null,
    parameters: [],
  },
  body: {
    text: null,
    parameters: [],
  },
  footer: {
    text: null,
  },
  buttons: [],
  carousel: {
    cards: [],
  },
});

const loadTemplate = async () => {
  try {
    const response = await axios.get("/templates/" + form.template);
    if (response) {
      console.log("Template data fetched successfully:", response.data);
      const metadata = JSON.parse(response.data.metadata);
      console.log("Template Metadata from GET api:", metadata);
      form.header.format = extractComponent(metadata, "HEADER", "format");
      form.header.text = extractComponent(metadata, "HEADER", "text");
      const headerExamples = extractComponent(metadata, "HEADER", "example");
      if (headerExamples) {
        if (form.header.format === "TEXT") {
          form.header.parameters = headerExamples.header_text.map((item) => ({
            type: "text",
            selection: "static",
            value: item,
          }));
        } else if (
          ["IMAGE", "DOCUMENT", "VIDEO"].includes(form.header.format)
        ) {
          form.header.parameters = headerExamples.header_handle.map(() => ({
            type: form.header.format,
            selection: "upload",
            value: null,
            url: null,
            fileName: null,
          }));
        }
      } else {
        form.header.parameters = [];
      }

      form.body.text = extractComponent(metadata, "BODY", "text");
      const bodyExamples = extractComponent(metadata, "BODY", "example");
      if (bodyExamples) {
        form.body.parameters = bodyExamples.body_text[0].map((item) => ({
          type: "text",
          selection: "static",
          value: item,
        }));
      } else {
        form.body.parameters = [];
      }

      form.footer.text = extractComponent(metadata, "FOOTER", "text");

      const buttons = extractComponent(metadata, "BUTTONS", "buttons");
      if (buttons) {
        form.buttons = buttons.map((item) => ({
          type: item.type,
          text: item.text,
          value: item[item.type.toLowerCase()] ?? null,
          parameters:
            item.type === "QUICK_REPLY"
              ? [{ type: "static", value: null }]
              : item.example
              ? item.example.map((param) => ({ type: "static", value: param }))
              : [],
        }));
      } else {
        form.buttons = [];
      }

      const carousel = metadata.components.find((c) => c.type === "CAROUSEL");
      if (carousel) {
        form.carousel.cards = carousel.cards.map((card) => {
          const cardHeader = card.components.find((c) => c.type === "HEADER");
          const cardBody = card.components.find((c) => c.type === "BODY");
          const cardButtons = card.components.find((c) => c.type === "BUTTONS");

          return {
            header: {
              format: cardHeader?.format || null,
              parameters: cardHeader?.example?.header_handle
                ? cardHeader.example.header_handle.map(() => ({
                    type: cardHeader.format,
                    selection: "upload",
                    value: null,
                    url: null,
                    fileName: null,
                  }))
                : [],
            },
            body: {
              text: cardBody?.text || null,
              parameters: cardBody?.example?.body_text?.[0]
                ? cardBody.example.body_text[0].map((item) => ({
                    type: "text",
                    selection: "static",
                    value: item,
                  }))
                : [],
            },
            buttons: cardButtons?.buttons
              ? cardButtons.buttons.map((button) => ({
                  type: button.type,
                  text: button.text,
                  value: button[button.type.toLowerCase()] ?? null,
                  parameters:
                    button.type === "QUICK_REPLY"
                      ? [{ type: "static", value: null }]
                      : button.example
                      ? button.example.map((param) => ({
                          type: "static",
                          value: param,
                        }))
                      : [],
                }))
              : [],
          };
        });
      } else {
        form.carousel.cards = [];
      }
    }
  } catch (error) {
    console.error("Error fetching data:", error);
  }
};

const uploadMedia = async (file, type) => {
  const formData = new FormData();
  formData.append("file", file);
  formData.append("type", type.toLowerCase());
  formData.append("messaging_product", "whatsapp");

  try {
    const response = await axios.post("/upload-file", formData, {
      headers: {
        "Content-Type": "multipart/form-data",
      },
    });
    console.log("Media uploaded successfully:", response.data);
    return response.data.public_url;
  } catch (error) {
    console.error("Error uploading media:", error);
    throw error;
  }
};

const handleFileUpload = async (event, cardIndex = null) => {
  const fileType =
    cardIndex !== null
      ? form.carousel.cards[cardIndex].header.parameters[0].type
      : form.header.parameters[0].type;

  const fileSizeLimit = getFileSizeLimit(fileType);
  const file = event.target.files[0];
  isTempLoading.value = true;
  if (file && file.size > fileSizeLimit) {
    alert(
      trans("file size exceeds the limit. Max allowed size:") +
        " " +
        fileSizeLimit +
        "b"
    );
    event.target.value = null;
    return;
  }

  try {
    const url = await uploadMedia(file, fileType);
    console.log("File uploaded successfully:", url);
    if (cardIndex !== null) {
      form.carousel.cards[cardIndex].header.parameters[0].url = url;
      form.carousel.cards[cardIndex].header.parameters[0].fileName = file.name;
    } else {
      form.header.parameters[0].url = url;
      form.header.parameters[0].fileName = file.name;
    }
  } catch (error) {
    alert(trans("Failed to upload file"));
    event.target.value = null;
  } finally {
    isTempLoading.value = false;
  }
};

const getFileAcceptAttribute = (fileType) => {
  switch (fileType) {
    case "IMAGE":
      return ".png, .jpg";
    case "DOCUMENT":
      return ".pdf, .txt, .ppt, .doc, .xls, .docx, .pptx, .xlsx";
    case "VIDEO":
      return ".mp4";
    default:
      return "";
  }
};

const getFileSizeLimit = (fileType) => {
  switch (fileType) {
    case "IMAGE":
      return 5 * 1024 * 1024; // 5MB
    case "DOCUMENT":
      return 100 * 1024 * 1024; // 100MB
    case "VIDEO":
      return 16 * 1024 * 1024; // 16MB
    default:
      return Infinity;
  }
};

const extractComponent = (data, type, customProperty) => {
  const component = data.components.find((c) => c.type === type);
  return component ? component[customProperty] : null;
};

const transformOptions = (options) => {
  return options.map((option) => ({
    value: option.uuid,
    label: option.language
      ? option.name + " [" + option.language + "]"
      : option.name,
  }));
};

const submitForm = () => {
  isLoading.value = true;

  const url = props.isCampaignFlow
    ? "/campaigns"
    : `/chat/${props.contact}/send/template`;
  const payload = form.data();
  console.log(props.isCampaignFlow ? "Campaign Flow" : "Single Contact Flow");

  console.log("POST Request:", JSON.stringify({ url, payload }, null, 2));

  form.post(url, {
    onFinish: () => {
      isLoading.value = false;
      if (!props.isCampaignFlow) {
        emit("viewTemplate", false);
      }
    },
  });
};

const submitCarouselForm = async () => {
  isLoading.value = true;

  const payload = {
    messaging_product: "whatsapp",
    recipient_type: "individual",
    to: props.isCampaignFlow ? form.contacts : props.contact,
    type: "template",
    template: {
      name: form.template,
      language: {
        code: "en",
      },
      components: [],
    },
  };

  if (form.carousel.cards.length > 0) {
    const carouselComponent = {
      type: "carousel",
      cards: form.carousel.cards.map((card, index) => ({
        card_index: index,
        components: [
          {
            type: "header",
            parameters: card.header.parameters.map((param) => ({
              type: param.type.toLowerCase(),
              [param.type.toLowerCase()]: {
                link: param.url,
              },
            })),
          },
          
        ],
      })),
    };
    payload.template.components.push(carouselComponent);
  }

  if (form.header.format && form.header.parameters.length > 0) {
    payload.template.components.push({
      type: "header",
      parameters: form.header.parameters.map((param) => ({
        type: param.type.toLowerCase(),
        [param.type.toLowerCase()]: {
          id: param.url,
        },
      })),
    });
  }

  if (form.body.text) {
    payload.template.components.push({
      type: "body",
      parameters: form.body.parameters.map((param) => ({
        type: "text",
        text: param.selection === "static" ? param.value : `{{${param.value}}}`,
      })),
    });
  }

  if (form.footer.text) {
    payload.template.components.push({
      type: "footer",
      text: form.footer.text,
    });
  }

  if (form.buttons.length > 0) {
    payload.template.components.push({
      type: "buttons",
      buttons: form.buttons.map((button) => ({
        type: button.type,
        text: button.text,
        ...(button.parameters.length > 0
          ? {
              parameters: button.parameters.map((param) => ({
                type: "text",
                text:
                  param.type === "static" ? param.value : `{{${param.value}}}`,
              })),
            }
          : {}),
      })),
    });
  }

  try {
    const url = "/send/crousel";

    console.log(
      "POST Request:",
      JSON.stringify(
        {
          url,
          payload,
          campaign_name: form.name,
        },
        null,
        2
      )
    );

    const res = await axios.post(url, {
      payload,
      campaign_name: form.name,
    });
    console.log("Response:", res.data);
    if (!props.isCampaignFlow) {
      emit("viewTemplate", false);
    }
  } catch (error) {
    console.error("Error sending carousel message:", error);
    alert(trans("Failed to send carousel message"));
  } finally {
    isLoading.value = false;
  }
};

const handleSubmit = async () => {
  if (form.carousel.cards.length > 0) {
    await submitCarouselForm();
  } else {
    await submitForm();
  }
  router.visit("/campaigns");
};

const emit = defineEmits(["viewTemplate"]);

const viewTemplate = () => {
  emit("viewTemplate", false);
};


onMounted(() => {
  // Filter templates with names starting with "carousel_"
  const filteredTemplates = props.templates.filter(template =>
    template.name?.startsWith('crousel_')
  );

  templateOptions.value = transformOptions(filteredTemplates);

  contactGroupOptions.value = [
    ...contactGroupOptions.value,
    ...transformOptions(props.contactGroups)
  ];
});


</script>

<template>
  <div :class="'md:flex md:flex-grow-1'">
    <form
      
      @submit.prevent="handleSubmit()"
      class="overflow-y-auto md:w-[50%]"
      :class="isCampaignFlow ? 'p-4 md:p-8 h-[90vh]' : ' h-full'"
    >
      <div
        v-if="displayTitle"
        class="m-1 rounded px-3 pt-3 pb-3 bg-slate-100 flex items-center justify-between mb-4"
      >
        <h3 class="text-[15px]">{{ $t("Send Template Message") }}</h3>
        <button
          @click="viewTemplate()"
          class="text-sm md:inline-flex hidden justify-center rounded-md border border-transparent bg-red-800 px-4 py-1 text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"
        >
          Cancel
        </button>
      </div>
      <div
        class="grid gap-x-6 gap-y-4 mb-8"
        :class="isCampaignFlow ? 'sm:grid-cols-6' : 'p-3 md:p-3'"
      >
        <FormInput
          v-if="isCampaignFlow"
          v-model="form.name"
          :name="$t('Campaign name')"
          :type="'text'"
          :error="form.errors.name"
          :required="true"
          :class="'sm:col-span-6'"
        />
        <FormSelect
          v-model="form.template"
          @update:modelValue="loadTemplate"
          :options="templateOptions"
          :required="true"
          :error="form.errors.template"
          :name="$t('Template')"
          :class="'sm:col-span-3'"
          :placeholder="$t('Select template')"
        />
        <FormSelect
          v-if="isCampaignFlow"
          v-model="form.contacts"
          :options="contactGroupOptions"
          :name="$t('Send to')"
          :required="true"
          :class="'sm:col-span-3'"
          :placeholder="$t('Select contacts')"
          :error="form.errors.contacts"
        />
        <FormInput
          v-if="isCampaignFlow && !form.skip_schedule"
          v-model="form.time"
          :name="$t('Scheduled time')"
          :type="'datetime-local'"
          :error="form.errors.time"
          :required="true"
          :class="'sm:col-span-6'"
        />
        <div v-if="isCampaignFlow" class="relative flex gap-x-3 sm:col-span-6">
          <div class="flex h-6 items-center">
            <input
              v-model="form.skip_schedule"
              id="skip-schedule"
              name="skip-schedule"
              type="checkbox"
              class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"
            />
          </div>
          <div class="text-sm leading-6">
            <label for="skip-schedule" class="font-medium text-gray-900">{{
              $t("Skip scheduling & send immediately")
            }}</label>
          </div>
        </div>
      </div>
      <div :class="isCampaignFlow ? '' : 'px-3 md:px-3'">
        <div
          v-if="form.header.parameters.length > 0"
          class="bg-slate-100 p-3 mt-4 text-sm"
        >
          <h2 class="flex items-center justify-between space-x-2 pb-2 border-b">
            <div class="flex items-center space-x-2">
              <span>{{ $t("Header variables") }}</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 1024 1024"
              >
                <path
                  fill="currentColor"
                  d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296c-44.096 0-108.992 44.736-148.48 101.504c0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04c67.84 0 107.904-43.648 147.456-100.416z"
                />
              </svg>
            </div>
            <span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M6.102 16.98c-1.074 0-1.648-1.264-.94-2.073l5.521-6.31a1.75 1.75 0 0 1 2.634 0l5.522 6.31c.707.809.133 2.073-.94 2.073H6.101Z"
                />
              </svg>
            </span>
          </h2>
          <div
            v-for="(item, index) in form.header.parameters"
            :key="index"
            class="mt-2 flex items-center space-x-4"
          >
            <div
              v-if="form.header.parameters[index].type === 'text'"
              class="w-full"
            >
              <FormSelect
                v-model="form.header.parameters[index].selection"
                :name="$t('Content type')"
                :options="variableOptions"
                :class="'sm:col-span-6'"
              />
            </div>
            <div
              v-if="form.header.parameters[index].type === 'text'"
              class="w-full"
            >
              <FormInput
                v-if="form.header.parameters[index].selection === 'static'"
                :name="$t('Value')"
                :required="true"
                :error="form.errors['header.parameters.0.value']"
                v-model="form.header.parameters[index].value"
                :type="'text'"
                :class="'sm:col-span-6'"
              />
              <FormSelect
                v-if="form.header.parameters[index].selection === 'dynamic'"
                :name="$t('Value')"
                :required="true"
                :error="form.errors['header.parameters.0.value']"
                v-model="form.header.parameters[index].value"
                :options="dynamicOptions"
                :class="'sm:col-span-6'"
              />
            </div>
            <div
              v-if="
                ['IMAGE', 'DOCUMENT', 'VIDEO'].includes(
                  form.header.parameters[index].type
                )
              "
              class="w-full mt-3"
            >
              <div class="flex items-center space-x-4">
                <label
                  class="cursor-pointer flex justify-center px-2 py-2 w-[30%] bg-slate-200 shadow-sm rounded-lg border"
                  :class="
                    form.errors['header.parameters.0.value']
                      ? 'border border-red-700'
                      : ''
                  "
                  for="file-upload"
                >
                  {{ $t("Upload") }}
                </label>
                <input
                  type="file"
                  class="sr-only"
                  :accept="
                    getFileAcceptAttribute(form.header.parameters[index].type)
                  "
                  ref="fileInput"
                  id="file-upload"
                  @change="handleFileUpload"
                />
                <div
                  v-if="form.header.parameters[index].fileName"
                  class="w-[20em] truncate"
                >
                  {{ form.header.parameters[index].fileName }}
                  <div
                    v-if="isTempLoading"
                    class="flex items-center justify-center min-h-screen"
                  >
                    <Loading v-if="isTempLoading" />
                  </div>
                </div>
                <span v-else>{{ $t("No file chosen") }}</span>
              </div>
              <p
                v-if="form.header.parameters[index].type === 'IMAGE'"
                class="text-left text-xs mt-2"
              >
                {{ $t("Max file upload size is") }} <b>5MB</b> <br />
                {{ $t("Supported file extensions") }}: .png, .jpg
              </p>
              <p
                v-if="form.header.parameters[index].type === 'DOCUMENT'"
                class="text-left text-xs mt-2"
              >
                {{ $t("Max file upload size is") }} <b>100MB</b> <br />
                {{ $t("Supported file extensions") }}: .pdf, .txt, .ppt, .doc,
                .xls, .docx, .pptx, .xlsx
              </p>
              <p
                v-if="form.header.parameters[index].type === 'VIDEO'"
                class="text-left text-xs mt-2"
              >
                {{ $t("Max file upload size is") }} <b>16MB</b> <br />
                {{ $t("Supported file extensions") }}: .mp4
              </p>
              <div
                v-if="form.errors['header.parameters.0.value']"
                class="form-error text-[#b91c1c] text-xs"
              >
                {{ form.errors["header.parameters.0.value"] }}
              </div>
            </div>
          </div>
        </div>
        <div
          v-if="form.body.parameters.length > 0"
          class="bg-slate-100 p-3 mt-1 text-sm"
        >
          <h2 class="flex items-center justify-between space-x-2 pb-2 border-b">
            <div class="flex items-center space-x-2">
              <span>{{ $t("Body variables") }}</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 1024 1024"
              >
                <path
                  fill="currentColor"
                  d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296c-44.096 0-108.992 44.736-148.48 101.504c0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04c67.84 0 107.904-43.648 147.456-100.416z"
                />
              </svg>
            </div>
            <span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M6.102 16.98c-1.074 0-1.648-1.264-.94-2.073l5.521-6.31a1.75 1.75 0 0 1 2.634 0l5.522 6.31c.707.809.133 2.073-.94 2.073H6.101Z"
                />
              </svg>
            </span>
          </h2>
          <div
            v-for="(item, index) in form.body.parameters"
            :key="index"
            class="mt-2 flex items-center space-x-4"
          >
            <div class="w-[30%]">
              <span v-text="'{{' + (index + 1) + '}}'"></span>
            </div>
            <div class="w-full">
              <FormSelect
                v-model="form.body.parameters[index].selection"
                :options="variableOptions"
                :class="'sm:col-span-6'"
              />
            </div>
            <div class="w-full">
              <FormInput
                v-if="form.body.parameters[index].selection === 'static'"
                v-model="form.body.parameters[index].value"
                :required="true"
                :error="form.errors['body.parameters.0.value']"
                :type="'text'"
                :class="'sm:col-span-6'"
              />
              <FormSelect
                v-if="form.body.parameters[index].selection === 'dynamic'"
                v-model="form.body.parameters[index].value"
                :required="true"
                :error="form.errors['body.parameters.0.value']"
                :options="dynamicOptions"
                :class="'sm:col-span-6'"
              />
            </div>
          </div>
        </div>
        <div
          v-if="form.carousel.cards.length > 0"
          class="bg-slate-100 p-3 mt-1 text-sm"
        >
          <h2 class="flex items-center justify-between space-x-2 pb-2 border-b">
            <div class="flex items-center space-x-2">
              <span>{{ $t("Carousel Cards") }}</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 1024 1024"
              >
                <path
                  fill="currentColor"
                  d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296c-44.096 0-108.992 44.736-148.48 101.504c0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04c67.84 0 107.904-43.648 147.456-100.416z"
                />
              </svg>
            </div>
            <span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M6.102 16.98c-1.074 0-1.648-1.264-.94-2.073l5.521-6.31a1.75 1.75 0 0 1 2.634 0l5.522 6.31c.707.809.133 2.073-.94 2.073H6.101Z"
                />
              </svg>
            </span>
          </h2>
          <div
            v-for="(card, cardIndex) in form.carousel.cards"
            :key="cardIndex"
            class="mt-4 bg-slate-50 p-3"
          >
            <h3 class="font-medium">{{ $t("Card") }} {{ cardIndex + 1 }}</h3>
            <div v-if="card.header.parameters.length > 0" class="mt-2">
              <h4>{{ $t("Header Image") }}</h4>
              <div class="flex items-center space-x-4">
                <label
                  class="cursor-pointer flex justify-center px-2 py-2 w-[30%] bg-slate-200 shadow-sm rounded-lg border"
                  :class="
                    form.errors[
                      `carousel.cards.${cardIndex}.header.parameters.0.value`
                    ]
                      ? 'border border-red-700'
                      : ''
                  "
                  :for="`file-upload-card-${cardIndex}`"
                >
                  {{ $t("Upload") }}
                </label>
                <input
                  type="file"
                  class="sr-only"
                  :accept="
                    getFileAcceptAttribute(card.header.parameters[0].type)
                  "
                  :id="`file-upload-card-${cardIndex}`"
                  @change="(event) => handleFileUpload(event, cardIndex)"
                />
                <div
                  v-if="card.header.parameters[0].fileName"
                  class="w-[20em] truncate"
                >
                  {{ card.header.parameters[0].fileName }}
                </div>
                <span v-else>{{ $t("No file chosen") }}</span>
              </div>
              <p
                v-if="card.header.parameters[0].type === 'IMAGE'"
                class="text-left text-xs mt-2"
              >
                {{ $t("Max file upload size is") }} <b>5MB</b> <br />
                {{ $t("Supported file extensions") }}: .png, .jpg
              </p>
              <div
                v-if="
                  form.errors[
                    `carousel.cards.${cardIndex}.header.parameters.0.value`
                  ]
                "
                class="form-error text-[#b91c1c] text-xs"
              >
                {{
                  form.errors[
                    `carousel.cards.${cardIndex}.header.parameters.0.value`
                  ]
                }}
              </div>
            </div>
            <div v-if="card.body.parameters.length > 0" class="mt-2">
              <h4>{{ $t("Body Variables") }}</h4>
              <div
                v-for="(param, paramIndex) in card.body.parameters"
                :key="paramIndex"
                class="mt-2 flex items-center space-x-4"
              >
                <div class="w-[30%]">
                  <span v-text="'{{' + (paramIndex + 1) + '}}'"></span>
                </div>
                <div class="w-full">
                  <FormSelect
                    v-model="param.selection"
                    :options="variableOptions"
                    :class="'sm:col-span-6'"
                  />
                </div>
                <div class="w-full">
                  <FormInput
                    v-if="param.selection === 'static'"
                    v-model="param.value"
                    :required="true"
                    :error="
                      form.errors[
                        `carousel.cards.${cardIndex}.body.parameters.${paramIndex}.value`
                      ]
                    "
                    :type="'text'"
                    :class="'sm:col-span-6'"
                  />
                  <FormSelect
                    v-if="param.selection === 'dynamic'"
                    v-model="param.value"
                    :required="true"
                    :error="
                      form.errors[
                        `carousel.cards.${cardIndex}.body.parameters.${paramIndex}.value`
                      ]
                    "
                    :options="dynamicOptions"
                    :class="'sm:col-span-6'"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        <div
          v-if="form.buttons.length > 0"
          class="bg-slate-100 p-3 mt-1 text-sm"
        >
          <h2 class="flex items-center justify-between space-x-2 pb-2 border-b">
            <div class="flex items-center space-x-2">
              <span>{{ $t("Button variables") }}</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 1024 1024"
              >
                <path
                  fill="currentColor"
                  d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296c-44.096 0-108.992 44.736-148.48 101.504c0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04c67.84 0 107.904-43.648 147.456-100.416z"
                />
              </svg>
            </div>
            <span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M6.102 16.98c-1.074 0-1.648-1.264-.94-2.073l5.521-6.31a1.75 1.75 0 0 1 2.634 0l5.522 6.31c.707.809.133 2.073-.94 2.073H6.101Z"
                />
              </svg>
            </span>
          </h2>
          <div v-for="(item, index) in form.buttons" :key="index">
            <div v-if="item.parameters.length > 0" class="mt-4 bg-slate-50 p-3">
              <div class="w-[100%] mb-1">
                <span>{{ $t("Label") }}: {{ item.text }}</span>
              </div>
              <div
                v-for="(value, key) in item.parameters"
                :key="key"
                class="flex items-center space-x-4"
              >
                <div class="w-full">
                  <FormSelect
                    v-model="value.type"
                    :name="$t('Button type')"
                    :options="variableOptions"
                    :class="'sm:col-span-6'"
                  />
                </div>
                <div class="w-full">
                  <FormInput
                    v-if="value.type === 'static'"
                    v-model="value.value"
                    :name="$t('Value')"
                    :required="true"
                    :error="
                      form.errors['buttons.' + index + '.parameters.0.value']
                    "
                    :type="'text'"
                    :class="'sm:col-span-6'"
                  />
                  <FormSelect
                    v-if="value.type === 'dynamic'"
                    v-model="value.value"
                    :name="$t('Value')"
                    :required="true"
                    :error="
                      form.errors['buttons.' + index + '.parameters.0.value']
                    "
                    :options="dynamicOptions"
                    :class="'sm:col-span-6'"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="flex items-center justify-end space-x-3 mt-3">
          <div v-if="displayCancelBtn">
            <Link
              href="/campaigns"
              class="block rounded-md px-3 py-2 text-sm text-gray-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 bg-slate-200"
            >
              {{ $t("Cancel") }}
            </Link>
          </div>
          <div>
            <button
              type="submit"
              class="rounded-md px-3 py-2 text-sm text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 bg-primary"
              :disabled="isLoading"
            >
              <span v-if="!isLoading">{{
                sendText ? sendText : $t("Save")
              }}</span>
              <svg
                v-else
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M12 2A10 10 0 1 0 22 12A10 10 0 0 0 12 2Zm0 18a8 8 0 1 1 8-8A8 8 0 0 1 12 20Z"
                  opacity=".5"
                />
                <path
                  fill="currentColor"
                  d="M20 12h2A10 10 0 0 0 12 2V4A8 8 0 0 1 20 12Z"
                >
                  <animateTransform
                    attributeName="transform"
                    dur="1s"
                    from="0 12 12"
                    repeatCount="indefinite"
                    to="360 12 12"
                    type="rotate"
                  />
                </path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </form>
    <div
      class="md:w-[50%] py-20 flex justify-center chat-bg"
      :class="isCampaignFlow ? 'px-20' : 'px-10'"
    >
      <div>
        <WhatsappTemplate
          :parameters="form"
          :visible="form.template ? true : false"
        />

        <CarouselPreview v-if="form.carousel.cards.length > 0" :cards="form.carousel.cards" />
      </div>
    </div>
  </div>
</template>

FlowTemplate Ui Code :

<script setup>
import axios from "axios";
import FormInput from "@/Components/FormInput.vue";
import FormSelect from "@/Components/FormSelect.vue";
import WhatsappTemplate from "@/Components/WhatsappTemplate.vue";
import { ref, onMounted } from "vue";
import { Link, useForm } from "@inertiajs/vue3";
import "vue3-toastify/dist/index.css";
import { trans } from "laravel-vue-i18n";
import { router } from "@inertiajs/vue3";

const props = defineProps({
  templates: Object,
  contactGroups: Object,
  settings: Array,
  contact: {
    type: String,
    default: null,
  },
  displayTitle: {
    type: Boolean,
    default: false,
  },
  displayCancelBtn: {
    type: Boolean,
    default: true,
  },
  isCampaignFlow: {
    type: Boolean,
    default: true,
  },
  sendText: {
    type: String,
    default: "Save",
  },

  // ✅ Additional props passed from CampaignForm.vue
  form: Object,
  settingsParsed: Object,
  isLoading: Boolean,
  contactGroupOptions: Array,
  templateOptions: Array,
  variableOptions: Array,
  dynamicOptions: Array,
});

const isTempLoading = ref(false);
const isLoading = ref(false);

const contactGroupOptions = ref([
  { value: "all", label: trans("all contacts") },
]);
const templateOptions = ref([]);
const config = ref(props.settings?.metadata);
const settings = ref(config.value ? JSON.parse(config.value) : null);

const variableOptions = ref([
  { value: "static", label: trans("static") },
  { value: "dynamic", label: trans("dynamic") },
]);

const dynamicOptions = ref([
  { value: "first name", label: trans("contact first name") },
  { value: "last name", label: trans("contact last name") },
  { value: "name", label: trans("contact full name") },
  { value: "phone", label: trans("contact phone") },
  { value: "email", label: trans("contact email") },
]);

const form = useForm({
  individual: props.contact ? props.contact : null,
  name: null,
  template: null,
  contacts: null,
  time: null,
  skip_schedule: false,
  header: {
    format: null,
    text: null,
    parameters: [],
  },
  body: {
    text: null,
    parameters: [],
  },
  footer: {
    text: null,
  },
  buttons: [],
  carousel: {
    cards: [],
  },
});

const loadTemplate = async () => {
  try {
    const response = await axios.get("/templates/" + form.template);
    if (response) {
      const metadata = JSON.parse(response.data.metadata);
      console.log("Template Metadata from GET api:", metadata);
      form.header.format = extractComponent(metadata, "HEADER", "format");
      form.header.text = extractComponent(metadata, "HEADER", "text");
      const headerExamples = extractComponent(metadata, "HEADER", "example");
      if (headerExamples) {
        if (form.header.format === "TEXT") {
          form.header.parameters = headerExamples.header_text.map((item) => ({
            type: "text",
            selection: "static",
            value: item,
          }));
        } else if (
          ["IMAGE", "DOCUMENT", "VIDEO"].includes(form.header.format)
        ) {
          form.header.parameters = headerExamples.header_handle.map(() => ({
            type: form.header.format,
            selection: "upload",
            value: null,
            url: null,
            fileName: null,
          }));
        }
      } else {
        form.header.parameters = [];
      }

      form.body.text = extractComponent(metadata, "BODY", "text");
      const bodyExamples = extractComponent(metadata, "BODY", "example");
      if (bodyExamples) {
        form.body.parameters = bodyExamples.body_text[0].map((item) => ({
          type: "text",
          selection: "static",
          value: item,
        }));
      } else {
        form.body.parameters = [];
      }

      form.footer.text = extractComponent(metadata, "FOOTER", "text");

      const buttons = extractComponent(metadata, "BUTTONS", "buttons");
      if (buttons) {
        form.buttons = buttons.map((item) => ({
          type: item.type,
          text: item.text,
          value: item[item.type.toLowerCase()] ?? null,
          parameters:
            item.type === "QUICK_REPLY"
              ? [{ type: "static", value: null }]
              : item.example
              ? item.example.map((param) => ({ type: "static", value: param }))
              : [],
        }));
      } else {
        form.buttons = [];
      }

      const carousel = metadata.components.find((c) => c.type === "CAROUSEL");
      if (carousel) {
        form.carousel.cards = carousel.cards.map((card) => {
          const cardHeader = card.components.find((c) => c.type === "HEADER");
          const cardBody = card.components.find((c) => c.type === "BODY");
          const cardButtons = card.components.find((c) => c.type === "BUTTONS");

          return {
            header: {
              format: cardHeader?.format || null,
              parameters: cardHeader?.example?.header_handle
                ? cardHeader.example.header_handle.map(() => ({
                    type: cardHeader.format,
                    selection: "upload",
                    value: null,
                    url: null,
                    fileName: null,
                  }))
                : [],
            },
            body: {
              text: cardBody?.text || null,
              parameters: cardBody?.example?.body_text?.[0]
                ? cardBody.example.body_text[0].map((item) => ({
                    type: "text",
                    selection: "static",
                    value: item,
                  }))
                : [],
            },
            buttons: cardButtons?.buttons
              ? cardButtons.buttons.map((button) => ({
                  type: button.type,
                  text: button.text,
                  value: button[button.type.toLowerCase()] ?? null,
                  parameters:
                    button.type === "QUICK_REPLY"
                      ? [{ type: "static", value: null }]
                      : button.example
                      ? button.example.map((param) => ({
                          type: "static",
                          value: param,
                        }))
                      : [],
                }))
              : [],
          };
        });
      } else {
        form.carousel.cards = [];
      }
    }
  } catch (error) {
    console.error("Error fetching data:", error);
  }
};

const uploadMedia = async (file, type) => {
  const formData = new FormData();
  formData.append("file", file);
  formData.append("type", type.toLowerCase());
  formData.append("messaging_product", "whatsapp");

  try {
    const response = await axios.post("/upload-file", formData, {
      headers: {
        "Content-Type": "multipart/form-data",
      },
    });
    console.log("Media uploaded successfully:", response.data);
    return response.data.public_url;
  } catch (error) {
    console.error("Error uploading media:", error);
    throw error;
  }
};

const handleFileUpload = async (event, cardIndex = null) => {
  const fileType =
    cardIndex !== null
      ? form.carousel.cards[cardIndex].header.parameters[0].type
      : form.header.parameters[0].type;

  const fileSizeLimit = getFileSizeLimit(fileType);
  const file = event.target.files[0];
  isTempLoading.value = true;
  if (file && file.size > fileSizeLimit) {
    alert(
      trans("file size exceeds the limit. Max allowed size:") +
        " " +
        fileSizeLimit +
        "b"
    );
    event.target.value = null;
    return;
  }

  try {
    const url = await uploadMedia(file, fileType);
    console.log("File uploaded successfully:", url);
    if (cardIndex !== null) {
      form.carousel.cards[cardIndex].header.parameters[0].url = url;
      form.carousel.cards[cardIndex].header.parameters[0].fileName = file.name;
    } else {
      form.header.parameters[0].url = url;
      form.header.parameters[0].fileName = file.name;
    }
  } catch (error) {
    alert(trans("Failed to upload file"));
    event.target.value = null;
  } finally {
    isTempLoading.value = false;
  }
};

const getFileAcceptAttribute = (fileType) => {
  switch (fileType) {
    case "IMAGE":
      return ".png, .jpg";
    case "DOCUMENT":
      return ".pdf, .txt, .ppt, .doc, .xls, .docx, .pptx, .xlsx";
    case "VIDEO":
      return ".mp4";
    default:
      return "";
  }
};

const getFileSizeLimit = (fileType) => {
  switch (fileType) {
    case "IMAGE":
      return 5 * 1024 * 1024; // 5MB
    case "DOCUMENT":
      return 100 * 1024 * 1024; // 100MB
    case "VIDEO":
      return 16 * 1024 * 1024; // 16MB
    default:
      return Infinity;
  }
};

const extractComponent = (data, type, customProperty) => {
  const component = data.components.find((c) => c.type === type);
  return component ? component[customProperty] : null;
};

const transformOptions = (options) => {
  return options.map((option) => ({
    value: option.uuid,
    label: option.language
      ? option.name + " [" + option.language + "]"
      : option.name,
  }));
};

const submitForm = () => {
  isLoading.value = true;
  console.log("Submitting form with data:", form.data());   
  const url = props.isCampaignFlow
    ? "/send/flow/template"
    : `/send/flow/template`;
  const payload = form.data();
  console.log(props.isCampaignFlow ? "Campaign Flow" : "Single Contact Flow");

  console.log("POST Request:", JSON.stringify({ url, payload }, null, 2));

  form.post(url, {
    onFinish: () => {
      isLoading.value = false;
      if (!props.isCampaignFlow) {
        emit("viewTemplate", false);
      }
    },
  });
};


const handleSubmit = async () => {
 
    try {
    await submitForm();

    if (props.isCampaignFlow) {
      router.visit("/campaigns", {
        preserveState: true,
        preserveScroll: true,
      });
    } else {
      router.visit("/chats", {
        preserveState: true,
        preserveScroll: true,
      });
    }
  } catch (error) {
    console.error("Error submitting form:", error);
    // Optionally show error to user
  }
};

const emit = defineEmits(["viewTemplate"]);

const viewTemplate = () => {
  emit("viewTemplate", false);
};


onMounted(() => {
  // Filter templates with names starting with "carousel_"
  const filteredTemplates = props.templates.filter(template =>
    template.name?.startsWith('flow_')
  );

  templateOptions.value = transformOptions(filteredTemplates);

  contactGroupOptions.value = [
    ...contactGroupOptions.value,
    ...transformOptions(props.contactGroups)
  ];
});


</script>

<template>
  <div :class="'md:flex md:flex-grow-1'">
    <div
      v-if="isTempLoading"
      class="flex items-center justify-center min-h-screen"
    >
      <Loading v-if="isTempLoading" />
    </div>
    

    <form
      
      @submit.prevent="handleSubmit()"
      class="overflow-y-auto md:w-[50%]"
      :class="isCampaignFlow ? 'p-4 md:p-8 h-[90vh]' : ' h-full'"
    >
      <div
        v-if="displayTitle"
        class="m-1 rounded px-3 pt-3 pb-3 bg-slate-100 flex items-center justify-between mb-4"
      >
        <h3 class="text-[15px]">{{ $t("Send Template Message") }}</h3>
        <button
          @click="viewTemplate()"
          class="text-sm md:inline-flex hidden justify-center rounded-md border border-transparent bg-red-800 px-4 py-1 text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"
        >
          Cancel
        </button>
      </div>
      <div
        class="grid gap-x-6 gap-y-4 mb-8"
        :class="isCampaignFlow ? 'sm:grid-cols-6' : 'p-3 md:p-3'"
      >
        <FormInput
          v-if="isCampaignFlow"
          v-model="form.name"
          :name="$t('Campaign name')"
          :type="'text'"
          :error="form.errors.name"
          :required="true"
          :class="'sm:col-span-6'"
        />
        <FormSelect
          v-model="form.template"
          @update:modelValue="loadTemplate"
          :options="templateOptions"
          :required="true"
          :error="form.errors.template"
          :name="$t('Template')"
          :class="'sm:col-span-3'"
          :placeholder="$t('Select template')"
        />
        <FormSelect
          v-if="isCampaignFlow"
          v-model="form.contacts"
          :options="contactGroupOptions"
          :name="$t('Send to')"
          :required="true"
          :class="'sm:col-span-3'"
          :placeholder="$t('Select contacts')"
          :error="form.errors.contacts"
        />
        <FormInput
          v-if="isCampaignFlow && !form.skip_schedule"
          v-model="form.time"
          :name="$t('Scheduled time')"
          :type="'datetime-local'"
          :error="form.errors.time"
          :required="true"
          :class="'sm:col-span-6'"
        />
        <div v-if="isCampaignFlow" class="relative flex gap-x-3 sm:col-span-6">
          <div class="flex h-6 items-center">
            <input
              v-model="form.skip_schedule"
              id="skip-schedule"
              name="skip-schedule"
              type="checkbox"
              class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"
            />
          </div>
          <div class="text-sm leading-6">
            <label for="skip-schedule" class="font-medium text-gray-900">{{
              $t("Skip scheduling & send immediately")
            }}</label>
          </div>
        </div>
      </div>
      <div :class="isCampaignFlow ? '' : 'px-3 md:px-3'">
        <div
          v-if="form.header.parameters.length > 0"
          class="bg-slate-100 p-3 mt-4 text-sm"
        >
          <h2 class="flex items-center justify-between space-x-2 pb-2 border-b">
            <div class="flex items-center space-x-2">
              <span>{{ $t("Header variables") }}</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 1024 1024"
              >
                <path
                  fill="currentColor"
                  d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296c-44.096 0-108.992 44.736-148.48 101.504c0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04c67.84 0 107.904-43.648 147.456-100.416z"
                />
              </svg>
            </div>
            <span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M6.102 16.98c-1.074 0-1.648-1.264-.94-2.073l5.521-6.31a1.75 1.75 0 0 1 2.634 0l5.522 6.31c.707.809.133 2.073-.94 2.073H6.101Z"
                />
              </svg>
            </span>
          </h2>
          <div
            v-for="(item, index) in form.header.parameters"
            :key="index"
            class="mt-2 flex items-center space-x-4"
          >
            <div
              v-if="form.header.parameters[index].type === 'text'"
              class="w-full"
            >
              <FormSelect
                v-model="form.header.parameters[index].selection"
                :name="$t('Content type')"
                :options="variableOptions"
                :class="'sm:col-span-6'"
              />
            </div>
            <div
              v-if="form.header.parameters[index].type === 'text'"
              class="w-full"
            >
              <FormInput
                v-if="form.header.parameters[index].selection === 'static'"
                :name="$t('Value')"
                :required="true"
                :error="form.errors['header.parameters.0.value']"
                v-model="form.header.parameters[index].value"
                :type="'text'"
                :class="'sm:col-span-6'"
              />
              <FormSelect
                v-if="form.header.parameters[index].selection === 'dynamic'"
                :name="$t('Value')"
                :required="true"
                :error="form.errors['header.parameters.0.value']"
                v-model="form.header.parameters[index].value"
                :options="dynamicOptions"
                :class="'sm:col-span-6'"
              />
            </div>
            <div
              v-if="
                ['IMAGE', 'DOCUMENT', 'VIDEO'].includes(
                  form.header.parameters[index].type
                )
              "
              class="w-full mt-3"
            >
              <div class="flex items-center space-x-4">
                <label
                  class="cursor-pointer flex justify-center px-2 py-2 w-[30%] bg-slate-200 shadow-sm rounded-lg border"
                  :class="
                    form.errors['header.parameters.0.value']
                      ? 'border border-red-700'
                      : ''
                  "
                  for="file-upload"
                >
                  {{ $t("Upload") }}
                </label>
                <input
                  type="file"
                  class="sr-only"
                  :accept="
                    getFileAcceptAttribute(form.header.parameters[index].type)
                  "
                  ref="fileInput"
                  id="file-upload"
                  @change="handleFileUpload"
                />
                <div
                  v-if="form.header.parameters[index].fileName"
                  class="w-[20em] truncate"
                >
                  {{ form.header.parameters[index].fileName }}
                </div>
                <span v-else>{{ $t("No file chosen") }}</span>
              </div>
              <p
                v-if="form.header.parameters[index].type === 'IMAGE'"
                class="text-left text-xs mt-2"
              >
                {{ $t("Max file upload size is") }} <b>5MB</b> <br />
                {{ $t("Supported file extensions") }}: .png, .jpg
              </p>
              <p
                v-if="form.header.parameters[index].type === 'DOCUMENT'"
                class="text-left text-xs mt-2"
              >
                {{ $t("Max file upload size is") }} <b>100MB</b> <br />
                {{ $t("Supported file extensions") }}: .pdf, .txt, .ppt, .doc,
                .xls, .docx, .pptx, .xlsx
              </p>
              <p
                v-if="form.header.parameters[index].type === 'VIDEO'"
                class="text-left text-xs mt-2"
              >
                {{ $t("Max file upload size is") }} <b>16MB</b> <br />
                {{ $t("Supported file extensions") }}: .mp4
              </p>
              <div
                v-if="form.errors['header.parameters.0.value']"
                class="form-error text-[#b91c1c] text-xs"
              >
                {{ form.errors["header.parameters.0.value"] }}
              </div>
            </div>
          </div>
        </div>
        <div
          v-if="form.body.parameters.length > 0"
          class="bg-slate-100 p-3 mt-1 text-sm"
        >
          <h2 class="flex items-center justify-between space-x-2 pb-2 border-b">
            <div class="flex items-center space-x-2">
              <span>{{ $t("Body variables") }}</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 1024 1024"
              >
                <path
                  fill="currentColor"
                  d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296c-44.096 0-108.992 44.736-148.48 101.504c0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04c67.84 0 107.904-43.648 147.456-100.416z"
                />
              </svg>
            </div>
            <span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M6.102 16.98c-1.074 0-1.648-1.264-.94-2.073l5.521-6.31a1.75 1.75 0 0 1 2.634 0l5.522 6.31c.707.809.133 2.073-.94 2.073H6.101Z"
                />
              </svg>
            </span>
          </h2>
          <div
            v-for="(item, index) in form.body.parameters"
            :key="index"
            class="mt-2 flex items-center space-x-4"
          >
            <div class="w-[30%]">
              <span v-text="'{{' + (index + 1) + '}}'"></span>
            </div>
            <div class="w-full">
              <FormSelect
                v-model="form.body.parameters[index].selection"
                :options="variableOptions"
                :class="'sm:col-span-6'"
              />
            </div>
            <div class="w-full">
              <FormInput
                v-if="form.body.parameters[index].selection === 'static'"
                v-model="form.body.parameters[index].value"
                :required="true"
                :error="form.errors['body.parameters.0.value']"
                :type="'text'"
                :class="'sm:col-span-6'"
              />
              <FormSelect
                v-if="form.body.parameters[index].selection === 'dynamic'"
                v-model="form.body.parameters[index].value"
                :required="true"
                :error="form.errors['body.parameters.0.value']"
                :options="dynamicOptions"
                :class="'sm:col-span-6'"
              />
            </div>
          </div>
        </div>
        <div
          v-if="form.carousel.cards.length > 0"
          class="bg-slate-100 p-3 mt-1 text-sm"
        >
          <h2 class="flex items-center justify-between space-x-2 pb-2 border-b">
            <div class="flex items-center space-x-2">
              <span>{{ $t("Carousel Cards") }}</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 1024 1024"
              >
                <path
                  fill="currentColor"
                  d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296c-44.096 0-108.992 44.736-148.48 101.504c0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04c67.84 0 107.904-43.648 147.456-100.416z"
                />
              </svg>
            </div>
            <span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M6.102 16.98c-1.074 0-1.648-1.264-.94-2.073l5.521-6.31a1.75 1.75 0 0 1 2.634 0l5.522 6.31c.707.809.133 2.073-.94 2.073H6.101Z"
                />
              </svg>
            </span>
          </h2>
          <div
            v-for="(card, cardIndex) in form.carousel.cards"
            :key="cardIndex"
            class="mt-4 bg-slate-50 p-3"
          >
            <h3 class="font-medium">{{ $t("Card") }} {{ cardIndex + 1 }}</h3>
            <div v-if="card.header.parameters.length > 0" class="mt-2">
              <h4>{{ $t("Header Image") }}</h4>
              <div class="flex items-center space-x-4">
                <label
                  class="cursor-pointer flex justify-center px-2 py-2 w-[30%] bg-slate-200 shadow-sm rounded-lg border"
                  :class="
                    form.errors[
                      `carousel.cards.${cardIndex}.header.parameters.0.value`
                    ]
                      ? 'border border-red-700'
                      : ''
                  "
                  :for="`file-upload-card-${cardIndex}`"
                >
                  {{ $t("Upload") }}
                </label>
                <input
                  type="file"
                  class="sr-only"
                  :accept="
                    getFileAcceptAttribute(card.header.parameters[0].type)
                  "
                  :id="`file-upload-card-${cardIndex}`"
                  @change="(event) => handleFileUpload(event, cardIndex)"
                />
                <div
                  v-if="card.header.parameters[0].fileName"
                  class="w-[20em] truncate"
                >
                  {{ card.header.parameters[0].fileName }}
                </div>
                <span v-else>{{ $t("No file chosen") }}</span>
              </div>
              <p
                v-if="card.header.parameters[0].type === 'IMAGE'"
                class="text-left text-xs mt-2"
              >
                {{ $t("Max file upload size is") }} <b>5MB</b> <br />
                {{ $t("Supported file extensions") }}: .png, .jpg
              </p>
              <div
                v-if="
                  form.errors[
                    `carousel.cards.${cardIndex}.header.parameters.0.value`
                  ]
                "
                class="form-error text-[#b91c1c] text-xs"
              >
                {{
                  form.errors[
                    `carousel.cards.${cardIndex}.header.parameters.0.value`
                  ]
                }}
              </div>
            </div>
            <div v-if="card.body.parameters.length > 0" class="mt-2">
              <h4>{{ $t("Body Variables") }}</h4>
              <div
                v-for="(param, paramIndex) in card.body.parameters"
                :key="paramIndex"
                class="mt-2 flex items-center space-x-4"
              >
                <div class="w-[30%]">
                  <span v-text="'{{' + (paramIndex + 1) + '}}'"></span>
                </div>
                <div class="w-full">
                  <FormSelect
                    v-model="param.selection"
                    :options="variableOptions"
                    :class="'sm:col-span-6'"
                  />
                </div>
                <div class="w-full">
                  <FormInput
                    v-if="param.selection === 'static'"
                    v-model="param.value"
                    :required="true"
                    :error="
                      form.errors[
                        `carousel.cards.${cardIndex}.body.parameters.${paramIndex}.value`
                      ]
                    "
                    :type="'text'"
                    :class="'sm:col-span-6'"
                  />
                  <FormSelect
                    v-if="param.selection === 'dynamic'"
                    v-model="param.value"
                    :required="true"
                    :error="
                      form.errors[
                        `carousel.cards.${cardIndex}.body.parameters.${paramIndex}.value`
                      ]
                    "
                    :options="dynamicOptions"
                    :class="'sm:col-span-6'"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        <div
          v-if="form.buttons.length > 0"
          class="bg-slate-100 p-3 mt-1 text-sm"
        >
          <h2 class="flex items-center justify-between space-x-2 pb-2 border-b">
            <div class="flex items-center space-x-2">
              <span>{{ $t("Button variables") }}</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 1024 1024"
              >
                <path
                  fill="currentColor"
                  d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296c-44.096 0-108.992 44.736-148.48 101.504c0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04c67.84 0 107.904-43.648 147.456-100.416z"
                />
              </svg>
            </div>
            <span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M6.102 16.98c-1.074 0-1.648-1.264-.94-2.073l5.521-6.31a1.75 1.75 0 0 1 2.634 0l5.522 6.31c.707.809.133 2.073-.94 2.073H6.101Z"
                />
              </svg>
            </span>
          </h2>
          <div v-for="(item, index) in form.buttons" :key="index">
            <div v-if="item.parameters.length > 0" class="mt-4 bg-slate-50 p-3">
              <div class="w-[100%] mb-1">
                <span>{{ $t("Label") }}: {{ item.text }}</span>
              </div>
              <div
                v-for="(value, key) in item.parameters"
                :key="key"
                class="flex items-center space-x-4"
              >
                <div class="w-full">
                  <FormSelect
                    v-model="value.type"
                    :name="$t('Button type')"
                    :options="variableOptions"
                    :class="'sm:col-span-6'"
                  />
                </div>
                <div class="w-full">
                  <FormInput
                    v-if="value.type === 'static'"
                    v-model="value.value"
                    :name="$t('Value')"
                    :required="true"
                    :error="
                      form.errors['buttons.' + index + '.parameters.0.value']
                    "
                    :type="'text'"
                    :class="'sm:col-span-6'"
                  />
                  <FormSelect
                    v-if="value.type === 'dynamic'"
                    v-model="value.value"
                    :name="$t('Value')"
                    :required="true"
                    :error="
                      form.errors['buttons.' + index + '.parameters.0.value']
                    "
                    :options="dynamicOptions"
                    :class="'sm:col-span-6'"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="flex items-center justify-end space-x-3 mt-3">
          <div v-if="displayCancelBtn">
            <Link
              href="/campaigns"
              class="block rounded-md px-3 py-2 text-sm text-gray-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 bg-slate-200"
            >
              {{ $t("Cancel") }}
            </Link>
          </div>
          <div>
            <button
              type="submit"
              class="rounded-md px-3 py-2 text-sm text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 bg-primary"
              :disabled="isLoading"
            >
              <span v-if="!isLoading">{{
                sendText ? sendText : $t("Save")
              }}</span>
              <svg
                v-else
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M12 2A10 10 0 1 0 22 12A10 10 0 0 0 12 2Zm0 18a8 8 0 1 1 8-8A8 8 0 0 1 12 20Z"
                  opacity=".5"
                />
                <path
                  fill="currentColor"
                  d="M20 12h2A10 10 0 0 0 12 2V4A8 8 0 0 1 20 12Z"
                >
                  <animateTransform
                    attributeName="transform"
                    dur="1s"
                    from="0 12 12"
                    repeatCount="indefinite"
                    to="360 12 12"
                    type="rotate"
                  />
                </path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </form>
    <div
      class="md:w-[50%] py-20 flex justify-center chat-bg"
      :class="isCampaignFlow ? 'px-20' : 'px-10'"
    >
      <div>
        <WhatsappTemplate
          :parameters="form"
          :visible="form.template ? true : false"
        />
      </div>
    </div>
  </div>
</template>

ChatForm Ui Code :

<script setup>
    import axios from 'axios';
    import { ref, watchEffect, computed, onMounted, onBeforeUnmount } from 'vue';
    import EmojiPicker from 'vue3-emoji-picker';
    import 'vue3-emoji-picker/css';
    import MicRecorder from 'mic-recorder-to-mp3-fixed';
    
    const recorder = ref(null);
    const props = defineProps(['contact', 'chatLimitReached', 'simpleForm']);
    const processingForm = ref(null);
    const processingAISuggestions = ref(false);
    const formTextInput = ref(null);
    const isRecording = ref(false);
    const audioChunks = ref([]);
    const recordingTime = ref(0);
    const timerInterval = ref(null);
    const playbackTime = ref(0);
    const playbackInterval = ref(null);
    const audioDuration = ref(0);
    const audioPreviewUrl = ref(null);
    const isPlaying = ref(false);
    const audioPlayer = ref(null);
    const isAudioRecording = ref(false);
    const form = ref({
        'uuid' : props.contact.uuid,
        'message' : null,
        'type' : null,
        'file' : null
    })
    const form2 = ref({
        'uuid' : props.contact.uuid,
        'message' : null,
        'type' : null,
        'file' : null
    })
    const emojiPicker = ref(false);
    const emojiPickerRef = ref(null);

    watchEffect(() => {
        form.value.uuid = props.contact.uuid;
    });

    const emit = defineEmits(['response', 'viewTemplate']);

    const viewTemplate = () => {
        emit('viewTemplate', true);
    }

    const sendMessage = async() => {
        form.value.message = formTextInput.value;
        processingForm.value = true;

        if(form.value.message != null || form.value.file != null){
            const formData = new FormData();

            formData.append('message', form.value.message);
            formData.append('type', form.value.type);
            formData.append('uuid', form.value.uuid);

            if (form.value.file) {
                formData.append('file', form.value.file);
            }

            try {
                const response = await axios.post('/chats', formData);

                if(isAudioRecording.value == true){
                    await sendAudioMessage();
                }

                form.value.message = null;
                formTextInput.value = null;
                form.value.file = null;

                processingForm.value = false;
            } catch (error) {
                // Handle the error
                // console.error('Error:', error);
            }
        } else {
            if(isAudioRecording.value == true){
                await sendAudioMessage();
            }

            processingForm.value = false;
        }
    }

    const sendAudioMessage = async() => {
        const formData = new FormData();
        formData.append('type', form2.value.type);
        formData.append('uuid', form2.value.uuid);

        if (form2.value.file) {
            formData.append('file', form2.value.file);
        }

        try {
            const response = await axios.post('/chats', formData);

            if(isAudioRecording.value == true){
                deleteRecording();
            }
        } catch (error) {
            // Handle the error
            // console.error('Error:', error);
        }
    }

    const textInputRef = ref(null);
    const adjustTextareaHeight = () => {
        const textInput = textInputRef.value;
        textInput.style.height = 'auto';
        textInput.style.height = textInput.scrollHeight + 'px';
    };

    const handleEnterKey = (event) => {
        if (formTextInput.value != null && formTextInput.value.trim() != '') {
            sendMessage();
        }
    };

    const isInboundChatWithin24Hours = computed(() => {
        if (props.contact.last_inbound_chat) {
            const lastInboundChatTime = new Date(props.contact.last_inbound_chat.created_at);
            const currentTime = new Date();
            const timeDifference = currentTime - lastInboundChatTime;

            return timeDifference < 24 * 60 * 60 * 1000;
        }

        return false;
    });

    const handleFileUpload = (event) => {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            form.value.file = file;
            sendMessage();
        };
        reader.readAsDataURL(file);
    }

    const getAcceptedFileTypes = () => {
        switch (form.value.type) {
            case 'image':
                return '.jpg, .png';
            case 'document':
                return '.txt, .pdf, .ppt, .doc, .xls, .docx, .pptx, .xlsx';
            case 'audio':
                return '.mp3, .ogg';
            case 'video':
                return '.mp4';
            default:
                return ''; // Empty string allows all file types
        }
    }

    const toggleEmojiPicker = (e) => {
        e.stopPropagation();
        emojiPicker.value = !emojiPicker.value;
    };

    const closeEmojiPicker = () => {
        emojiPicker.value = false;
    };

    const addEmoji = (emoji) => {
        const textarea = textInputRef.value;
        const currentValue = formTextInput.value || '';
        const start = textarea.selectionStart || 0;
        const end = textarea.selectionEnd || 0;

        const newText =
            currentValue.substring(0, start) +
            emoji.i +
            currentValue.substring(end);

        formTextInput.value = newText;

        // Focus the textarea and place the cursor at the correct position
        setTimeout(() => {
            textarea.focus();
            textarea.setSelectionRange(start + emoji.i.length, start + emoji.i.length);
        }, 0);
    };

    const handleClickOutside = (event) => {
        if (
            emojiPickerRef.value &&
            !emojiPickerRef.value.contains(event.target) &&
            !textInputRef.value.contains(event.target)
        ) {
            closeEmojiPicker();
        }
    };

    const startRecording = async () => {
        try {
            isAudioRecording.value = true;
            await recorder.value.start();
            isRecording.value = true;
            startTimer();
        } catch (error) {
            console.error('Error accessing microphone:', error);
        }
    };

    const stopRecording = async () => {
        if (isRecording.value) {
            try {
                const [buffer, blob] = await recorder.value.stop().getMp3();
                const audioFile = new File(buffer, 'audio-message.mp3', {
                    type: blob.type,
                    lastModified: Date.now()
                });
                
                audioPreviewUrl.value = URL.createObjectURL(blob);
                form2.value.type = 'audio';
                form2.value.file = audioFile;
                
                isRecording.value = false;
                stopTimer();
            } catch (error) {
                console.error('Error stopping recording:', error);
            }
        }
    };

    const deleteRecording = () => {
        if (audioPreviewUrl.value) {
            URL.revokeObjectURL(audioPreviewUrl.value);
        }
        audioPreviewUrl.value = null;
        recordingTime.value = 0;
        playbackTime.value = 0;
        audioDuration.value = 0;
        audioChunks.value = [];
        form2.value.type = null;
        form2.value.file = null;
        stopPlaybackTimer();
    };

    const togglePlayback = () => {
        if (!audioPlayer.value) return;
        
        if (isPlaying.value) {
            audioPlayer.value.pause();
            stopPlaybackTimer();
        } else {
            audioPlayer.value.play();
            startPlaybackTimer();
        }
        isPlaying.value = !isPlaying.value;
    };

    const startTimer = () => {
        recordingTime.value = 0;
        timerInterval.value = setInterval(() => {
            recordingTime.value++;
        }, 1000);
    };

    const startPlaybackTimer = () => {
        playbackTime.value = 0;
        playbackInterval.value = setInterval(() => {
            if (audioPlayer.value) {
                playbackTime.value = Math.floor(audioPlayer.value.currentTime);
            }
        }, 100);
    };

    const stopTimer = () => {
        if (timerInterval.value) {
            clearInterval(timerInterval.value);
            timerInterval.value = null;
        }
    };

    const stopPlaybackTimer = () => {
        if (playbackInterval.value) {
            clearInterval(playbackInterval.value);
            playbackInterval.value = null;
        }
    };

    const formatTime = (seconds) => {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    };

    const getSuggestion = async() => {
        processingAISuggestions.value = true;
        try {
            const response = await axios.get('/automation/chat/suggestion', {
                params: {
                    contact: props.contact.uuid
                }
            });

            if (response.data.success) {
                form.value.type = 'text';
                formTextInput.value = response.data.data.text;
            } else {
                console.error('Failed to get suggestion:', response.data.message);
            }
        } catch (error) {
            console.error('Error getting suggestion:', error.response?.data?.message || error.message);
        } finally {
            processingAISuggestions.value = false;
        }
    }

    onMounted(() => {
        document.addEventListener('click', handleClickOutside);
        recorder.value = new MicRecorder({
            bitRate: 128
        });
    });

    onBeforeUnmount(() => {
        document.removeEventListener('click', handleClickOutside);
        stopTimer();
        stopPlaybackTimer();
        if (audioPreviewUrl.value) {
            URL.revokeObjectURL(audioPreviewUrl.value);
        }
    });
</script>
<template>
    <div v-if="props.chatLimitReached" class="flex justify-center items-center w-full px-6 md:px-4">
        <div class="flex items-start space-x-4 bg-orange-100 rounded-lg p-2 mb-2 px-4">
            <span class="text-red-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 36 36"><path fill="currentColor" d="M18 21.32a1.3 1.3 0 0 0 1.3-1.3V14a1.3 1.3 0 1 0-2.6 0v6a1.3 1.3 0 0 0 1.3 1.32Z" class="clr-i-outline clr-i-outline-path-1"/><circle cx="17.95" cy="24.27" r="1.5" fill="currentColor" class="clr-i-outline clr-i-outline-path-2"/><path fill="currentColor" d="M30.33 25.54L20.59 7.6a3 3 0 0 0-5.27 0L5.57 25.54A3 3 0 0 0 8.21 30h19.48a3 3 0 0 0 2.64-4.43Zm-1.78 1.94a1 1 0 0 1-.86.49H8.21a1 1 0 0 1-.88-1.48l9.74-17.94a1 1 0 0 1 1.76 0l9.74 17.94a1 1 0 0 1-.02.99Z" class="clr-i-outline clr-i-outline-path-3"/><path fill="none" d="M0 0h36v36H0z"/></svg>
            </span>
            <div>
                <div class="text-sm">{{ $t('Maximum chat limit reached') }}</div>
                <div class="text-sm">{{ $t('You have reached the maximum chat limit for your subscription! Please upgrade to send/receive more messages') }}</div>
            </div>
        </div>
    </div>
    <div v-if="!isInboundChatWithin24Hours && !props.chatLimitReached" class="flex justify-center items-center w-full px-6 md:px-4">
        <div class="flex items-center justify-between space-x-4 bg-orange-100 rounded-lg p-2 mb-2 px-4">
            <div class="flex items-start justify-between space-x-4">
                <span class="text-red-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 36 36"><path fill="currentColor" d="M18 21.32a1.3 1.3 0 0 0 1.3-1.3V14a1.3 1.3 0 1 0-2.6 0v6a1.3 1.3 0 0 0 1.3 1.32Z" class="clr-i-outline clr-i-outline-path-1"/><circle cx="17.95" cy="24.27" r="1.5" fill="currentColor" class="clr-i-outline clr-i-outline-path-2"/><path fill="currentColor" d="M30.33 25.54L20.59 7.6a3 3 0 0 0-5.27 0L5.57 25.54A3 3 0 0 0 8.21 30h19.48a3 3 0 0 0 2.64-4.43Zm-1.78 1.94a1 1 0 0 1-.86.49H8.21a1 1 0 0 1-.88-1.48l9.74-17.94a1 1 0 0 1 1.76 0l9.74 17.94a1 1 0 0 1-.02.99Z" class="clr-i-outline clr-i-outline-path-3"/><path fill="none" d="M0 0h36v36H0z"/></svg>
                </span>
                <div>
                    <div class="text-sm">{{ $t('24 hour limit') }}</div>
                    <div class="text-sm">{{ $t('Whatsapp does not allow sending messages 24 hours after they last messaged you. However, you can send them a template message') }}</div>
                </div>
            </div>
            <button @click="viewTemplate()" class="rounded-md bg-primary px-3 py-1 text-sm text-white shadow-sm w-[25%]">Send Template</button>
        </div>
    </div>
    <form v-if="simpleForm && isInboundChatWithin24Hours && !props.chatLimitReached" @submit.prevent="sendMessage()" class="flex items-center px-2 md:px-10 space-x-2">
        <div class="flex items-center w-full rounded-lg py-4 md:py-2 pl-2 pr-2" :class="processingForm ? 'bg-gray-200' : 'bg-white'">
            <div class="absolute">
                <button type="button" @click="toggleEmojiPicker">😀</button>
                <div v-if="emojiPicker" class="absolute left-0 bottom-full" ref="emojiPickerRef">
                    <EmojiPicker :native="true" @select="addEmoji" />
                </div>
            </div>
            <textarea 
                ref="textInputRef" 
                @focus="form.type = 'text'"
                @keydown.enter.exact.prevent="handleEnterKey" 
                class="w-full ml-3 outline-none resize-none text-sm md:text-base pl-6" 
                :class="processingForm ? 'bg-gray-200' : 'bg-white'"
                v-model="formTextInput" 
                @input="adjustTextareaHeight" 
                type="text" 
                rows="1" 
                :placeholder="$t('Type your message...')" 
                :disabled="processingForm">
            </textarea>
            <input
                type="file"
                class="sr-only"
                :accept="getAcceptedFileTypes()"
                id="file-upload"
                @change="handleFileUpload($event)"
            />
            <label @click="form.type = 'image'" for="file-upload" class="text-slate-500 mr-2 cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M6.5 8a2 2 0 1 0 4 0a2 2 0 0 0-4 0Zm14.427 1.99c-6.61-.908-12.31 4-11.927 10.51"/><path d="M3 13.066c2.78-.385 5.275.958 6.624 3.1"/><path d="M3 12c0-4.243 0-6.364 1.318-7.682C5.636 3 7.758 3 12 3c4.243 0 6.364 0 7.682 1.318C21 5.636 21 7.758 21 12c0 4.243 0 6.364-1.318 7.682C18.364 21 16.242 21 12 21c-4.243 0-6.364 0-7.682-1.318C3 18.364 3 16.242 3 12Z"/></g></svg>
            </label>
            <label @click="form.type = 'document'" for="file-upload" class="text-slate-500 mr-1 cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 10c0-3.771 0-5.657 1.172-6.828C5.343 2 7.229 2 11 2h2c3.771 0 5.657 0 6.828 1.172C21 4.343 21 6.229 21 10v4c0 3.771 0 5.657-1.172 6.828C18.657 22 16.771 22 13 22h-2c-3.771 0-5.657 0-6.828-1.172C3 19.657 3 17.771 3 14v-4Z"/><path stroke-linecap="round" d="M8 10h8m-8 4h5"/></g></svg>
            </label>
            <label @click="form.type = 'audio'" for="file-upload" class="text-slate-500 mr-1 cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 1024 1024"><path fill="currentColor" d="M842 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8c0 140.3-113.7 254-254 254S258 594.3 258 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8c0 168.7 126.6 307.9 290 327.6V884H326.7c-13.7 0-24.7 14.3-24.7 32v36c0 4.4 2.8 8 6.2 8h407.6c3.4 0 6.2-3.6 6.2-8v-36c0-17.7-11-32-24.7-32H548V782.1c165.3-18 294-158 294-328.1M512 624c93.9 0 170-75.2 170-168V232c0-92.8-76.1-168-170-168s-170 75.2-170 168v224c0 92.8 76.1 168 170 168m-94-392c0-50.6 41.9-92 94-92s94 41.4 94 92v224c0 50.6-41.9 92-94 92s-94-41.4-94-92z"/></svg>
            </label>
            <label @click="form.type = 'video'" for="file-upload" class="text-slate-500 mr-2 cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 32 32"><path fill="currentColor" d="M6.5 5.5A4.5 4.5 0 0 0 2 10v12a4.5 4.5 0 0 0 4.5 4.5h12A4.5 4.5 0 0 0 23 22v-1.5l4.2 3.15c1.153.865 2.8.042 2.8-1.4V9.75c0-1.442-1.647-2.265-2.8-1.4L23 11.5V10a4.5 4.5 0 0 0-4.5-4.5zM23 14l5-3.75v11.5L23 18zm-2-4v12a2.5 2.5 0 0 1-2.5 2.5h-12A2.5 2.5 0 0 1 4 22V10a2.5 2.5 0 0 1 2.5-2.5h12A2.5 2.5 0 0 1 21 10"/></svg>
            </label>
            <label @click="viewTemplate()" class="text-slate-500 mr-4 cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256"><path fill="currentColor" d="M216 80h-32V48a16 16 0 0 0-16-16H40a16 16 0 0 0-16 16v128a8 8 0 0 0 13 6.22L72 154v30a16 16 0 0 0 16 16h93.59L219 230.22a8 8 0 0 0 5 1.78a8 8 0 0 0 8-8V96a16 16 0 0 0-16-16M66.55 137.78L40 159.25V48h128v88H71.58a8 8 0 0 0-5.03 1.78M216 207.25l-26.55-21.47a8 8 0 0 0-5-1.78H88v-32h80a16 16 0 0 0 16-16V96h32Z"></path></svg>
            </label>
            <button class="flex items-center" type="submit" :disabled="formTextInput === null || formTextInput.trim() === '' || processingForm">
                <svg v-if="!processingForm" :class="formTextInput === null || formTextInput.trim() === '' ? 'text-slate-300' : 'text-black'" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 16 16"><path fill="currentColor" d="M1.724 1.053a.5.5 0 0 0-.714.545l1.403 4.85a.5.5 0 0 0 .397.354l5.69.953c.268.053.268.437 0 .49l-5.69.953a.5.5 0 0 0-.397.354l-1.403 4.85a.5.5 0 0 0 .714.545l13-6.5a.5.5 0 0 0 0-.894l-13-6.5Z"/></svg>
                <svg v-else xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="2" r="0" fill="currentColor"><animate attributeName="r" begin="0" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(45 12 12)"><animate attributeName="r" begin="0.125s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(90 12 12)"><animate attributeName="r" begin="0.25s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(135 12 12)"><animate attributeName="r" begin="0.375s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(180 12 12)"><animate attributeName="r" begin="0.5s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(225 12 12)"><animate attributeName="r" begin="0.625s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(270 12 12)"><animate attributeName="r" begin="0.75s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(315 12 12)"><animate attributeName="r" begin="0.875s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle></svg>
            </button>
        </div>
    </form>
    <form v-if="!simpleForm && isInboundChatWithin24Hours && !props.chatLimitReached" @submit.prevent="sendMessage()" class="flex items-center px-2 md:px-10 space-x-2">
        <div class="bg-white rounded-md w-full p-4">
            <div>
                <textarea 
                    ref="textInputRef" 
                    @focus="form.type = 'text'"
                    @keydown.enter.exact.prevent="handleEnterKey" 
                    class="w-full outline-none resize-none text-sm rounded-md p-2" 
                    :class="processingForm ? 'bg-gray-100' : 'bg-white'"
                    v-model="formTextInput" 
                    @input="adjustTextareaHeight" 
                    type="text" 
                    rows="3" 
                    :placeholder="$t('Type your message...')" 
                    :disabled="processingForm">
                </textarea>
                <input
                    type="file"
                    class="sr-only"
                    :accept="getAcceptedFileTypes()"
                    id="file-upload"
                    @change="handleFileUpload($event)"
                />
            </div>
            <!-- Recording Interface -->
            <div v-if="isRecording || audioPreviewUrl" class="bg-slate-50 rounded-lg border px-2 mb-2">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="text-red-500 mr-2">
                            <span v-if="isRecording" class="animate-pulse">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="12" r="7" fill="red" opacity="0.5"/><path fill="#fee2e2" fill-rule="evenodd" d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10m0-3a7 7 0 1 0 0-14a7 7 0 0 0 0 14" clip-rule="evenodd"/></svg>
                            </span>
                            <span v-if="audioPreviewUrl" @click="togglePlayback">
                                <svg v-if="!isPlaying" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="#22c55e" stroke="#22c55e" stroke-linecap="round" stroke-width="1.5" d="M3 12v6.967c0 2.31 2.534 3.769 4.597 2.648l3.203-1.742M3 8V5.033c0-2.31 2.534-3.769 4.597-2.648l12.812 6.968a2.998 2.998 0 0 1 0 5.294l-6.406 3.484"/></svg>
                                <svg v-else xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="red" stroke-linecap="round" stroke-width="1.5" d="M2 18c0 1.886 0 2.828.586 3.414S4.114 22 6 22s2.828 0 3.414-.586S10 19.886 10 18V6c0-1.886 0-2.828-.586-3.414S7.886 2 6 2s-2.828 0-3.414.586S2 4.114 2 6v8m20-8c0-1.886 0-2.828-.586-3.414S19.886 2 18 2s-2.828 0-3.414.586S14 4.114 14 6v12c0 1.886 0 2.828.586 3.414S16.114 22 18 22s2.828 0 3.414-.586S22 19.886 22 18v-8"/></svg>
                            </span>
                        </span>
                        <span class="text-sm" v-if="isRecording">{{ formatTime(recordingTime) }}</span>
                        <span class="text-sm" v-else>{{ formatTime(playbackTime) }} / {{ formatTime(recordingTime) }}</span>
                    </div>
                    <div class="flex gap-2">
                        <!-- Stop Recording Button -->
                        <button 
                            v-if="isRecording"
                            @click="stopRecording"
                            class="p-2 rounded-full hover:bg-red-100"
                            title="Stop Recording">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="red" stroke="red" stroke-width="1.5" d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2s7.071 0 8.535 1.464C22 4.93 22 7.286 22 12s0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/></svg>
                        </button>

                        <!-- Delete Button -->
                        <button 
                            v-if="audioPreviewUrl"
                            @click="deleteRecording"
                            class="p-2 rounded-full hover:bg-red-100 text-red-500"
                            title="Delete Recording">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="red" stroke-linecap="round" stroke-width="1.5" d="M9.17 4a3.001 3.001 0 0 1 5.66 0m5.67 2h-17m14.874 9.4c-.177 2.654-.266 3.981-1.131 4.79s-2.195.81-4.856.81h-.774c-2.66 0-3.99 0-4.856-.81c-.865-.809-.953-2.136-1.13-4.79l-.46-6.9m13.666 0l-.2 3M9.5 11l.5 5m4.5-5l-.5 5"/></svg>
                        </button>
                    </div>
                </div>
                <audio ref="audioPlayer" :src="audioPreviewUrl" @ended="isPlaying = false" class="hidden" />
            </div>
            <div class="flex gap-x-4 items-center text-gray-600">
                <div @click="viewTemplate()" class="flex gap-x-1 text-sm items-center">
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256"><path fill="currentColor" d="M216 80h-32V48a16 16 0 0 0-16-16H40a16 16 0 0 0-16 16v128a8 8 0 0 0 13 6.22L72 154v30a16 16 0 0 0 16 16h93.59L219 230.22a8 8 0 0 0 5 1.78a8 8 0 0 0 8-8V96a16 16 0 0 0-16-16M66.55 137.78L40 159.25V48h128v88H71.58a8 8 0 0 0-5.03 1.78M216 207.25l-26.55-21.47a8 8 0 0 0-5-1.78H88v-32h80a16 16 0 0 0 16-16V96h32Z"></path></svg>
                    </span>
                    <button>{{ $t('Templates') }}</button>
                </div>
                <div>|</div>
                <div class="flex gap-x-4 text-sm items-center">
                    <div>
                        <button type="button" class="py-1" @click="toggleEmojiPicker">
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M4.111 2.18a7 7 0 1 1 7.778 11.64A7 7 0 0 1 4.11 2.18zm.556 10.809a6 6 0 1 0 6.666-9.978a6 6 0 0 0-6.666 9.978M6.5 7a1 1 0 1 1-2 0a1 1 0 0 1 2 0m5 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0M8 11a3 3 0 0 1-2.65-1.58l-.87.48a4 4 0 0 0 7.12-.16l-.9-.43A3 3 0 0 1 8 11" clip-rule="evenodd"/></svg>
                            </span>
                        </button>
                        <div class="absolute">
                            
                            <div v-if="emojiPicker" class="absolute left-0 bottom-full" ref="emojiPickerRef">
                                <EmojiPicker :native="true" @select="addEmoji" />
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="py-1 cursor-pointer" @click="form.type = 'document'" for="file-upload">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 56 56"><path fill="currentColor" d="M44.09 28.867L26.863 46.094c-4.476 4.5-10.5 4.054-14.343.164c-3.867-3.844-4.313-9.82.187-14.32L36.191 8.453c2.696-2.695 6.657-3.07 9.235-.515c2.555 2.601 2.18 6.539-.492 9.234L21.988 40.14c-1.171 1.195-2.554.843-3.375.047c-.796-.82-1.125-2.18.047-3.376l16.031-16.007c.704-.727.75-1.758.07-2.438c-.679-.656-1.71-.61-2.413.094L16.246 34.563c-2.39 2.39-2.297 6.046-.187 8.156c2.297 2.297 5.789 2.25 8.18-.164l23.085-23.063c4.383-4.383 4.172-10.148.375-13.969c-3.75-3.726-9.586-4.007-13.992.375L10.082 29.547c-5.789 5.789-5.344 14.062-.117 19.289c5.227 5.203 13.5 5.648 19.289-.117l17.344-17.344c.703-.68.68-1.922-.024-2.555c-.68-.726-1.78-.633-2.484.047"/></svg>
                        </label>
                    </div>
                    <div>
                        <label @click="form.type = 'audio'" class="py-1 cursor-pointer" for="file-upload">
                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 19a3 3 0 1 1-6 0a3 3 0 0 1 6 0Zm12-2a3 3 0 1 1-6 0a3 3 0 0 1 6 0ZM9 19V8m12 9V6"/><path stroke-linecap="round" d="m15.735 3.755l-4 1.333c-1.32.44-1.98.66-2.357 1.184S9 7.492 9 8.882V12l12-4v-.45c0-2.533 0-3.8-.83-4.398c-.831-.599-2.032-.198-4.435.603Z"/></g></svg>
                        </label>
                    </div>
                    <div>
                        <label @click="form.type = 'video'" class="py-1 cursor-pointer" for="file-upload">
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 32 32"><path fill="currentColor" d="M6.5 5.5A4.5 4.5 0 0 0 2 10v12a4.5 4.5 0 0 0 4.5 4.5h12A4.5 4.5 0 0 0 23 22v-1.5l4.2 3.15c1.153.865 2.8.042 2.8-1.4V9.75c0-1.442-1.647-2.265-2.8-1.4L23 11.5V10a4.5 4.5 0 0 0-4.5-4.5zM23 14l5-3.75v11.5L23 18zm-2-4v12a2.5 2.5 0 0 1-2.5 2.5h-12A2.5 2.5 0 0 1 4 22V10a2.5 2.5 0 0 1 2.5-2.5h12A2.5 2.5 0 0 1 21 10"/></svg>
                        </label>
                    </div>
                    <div>
                        <label class="py-1 cursor-pointer" @click="form.type = 'image'" for="file-upload">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M6.5 8a2 2 0 1 0 4 0a2 2 0 0 0-4 0Zm14.427 1.99c-6.61-.908-12.31 4-11.927 10.51"/><path d="M3 13.066c2.78-.385 5.275.958 6.624 3.1"/><path d="M3 12c0-4.243 0-6.364 1.318-7.682C5.636 3 7.758 3 12 3c4.243 0 6.364 0 7.682 1.318C21 5.636 21 7.758 21 12c0 4.243 0 6.364-1.318 7.682C18.364 21 16.242 21 12 21c-4.243 0-6.364 0-7.682-1.318C3 18.364 3 16.242 3 12Z"/></g></svg>
                        </label>
                    </div>
                </div>
                <div>|</div>
                <button 
                    type="button"
                    class="py-1 cursor-pointer relative" 
                    @click="startRecording"
                    v-if="!isRecording && !audioPreviewUrl">
                    <span class="relative">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 1024 1024">
                            <path fill="currentColor" d="M842 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8c0 140.3-113.7 254-254 254S258 594.3 258 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8c0 168.7 126.6 307.9 290 327.6V884H326.7c-13.7 0-24.7 14.3-24.7 32v36c0 4.4 2.8 8 6.2 8h407.6c3.4 0 6.2-3.6 6.2-8v-36c0-17.7-11-32-24.7-32H548V782.1c165.3-18 294-158 294-328.1M512 624c93.9 0 170-75.2 170-168V232c0-92.8-76.1-168-170-168s-170 75.2-170 168v224c0 92.8 76.1 168 170 168m-94-392c0-50.6 41.9-92 94-92s94 41.4 94 92v224c0 50.6-41.9 92-94 92s-94-41.4-94-92z"/>
                        </svg>
                    </span>
                </button>
                <div class="ms-[-5px]">
                    <button v-if="!processingAISuggestions" class="text-[14px] flex items-center gap-2 hover:bg-gray-100 p-1 rounded-md" type="button" @click="getSuggestion()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" color="#000"><path d="m7 8l2.942 1.74c1.715 1.014 2.4 1.014 4.116 0L17 8"/><path d="M21.984 12.976c.021-.986.021-1.966 0-2.952c-.065-3.065-.098-4.598-1.229-5.733c-1.131-1.136-2.705-1.175-5.854-1.254a115 115 0 0 0-5.802 0c-3.149.079-4.723.118-5.854 1.254c-1.131 1.135-1.164 2.668-1.23 5.733a69 69 0 0 0 0 2.952c.066 3.065.099 4.598 1.23 5.733c1.131 1.136 2.705 1.175 5.854 1.254c1.305.033 2.601.044 3.901.033"/><path d="m18.5 14l.258.697c.338.914.507 1.371.84 1.704c.334.334.791.503 1.705.841L22 17.5l-.697.258c-.914.338-1.371.507-1.704.84c-.334.334-.503.791-.841 1.705L18.5 21l-.258-.697c-.338-.914-.507-1.371-.84-1.704c-.334-.334-.791-.503-1.705-.841L15 17.5l.697-.258c.914-.338 1.371-.507 1.704-.84c.334-.334.503-.791.841-1.705z"/></g></svg>
                        <span>{{ $t('AI Assist') }}</span>
                    </button>
                    <div v-else class="text-[14px] flex items-center gap-2 bg-gray-100 p-1 px-2 rounded-md">
                        <span>{{ $t('Searching for suggestions') }}</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="18" cy="12" r="0" fill="currentColor"><animate attributeName="r" begin=".67" calcMode="spline" dur="1.5s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="12" r="0" fill="currentColor"><animate attributeName="r" begin=".33" calcMode="spline" dur="1.5s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="6" cy="12" r="0" fill="currentColor"><animate attributeName="r" begin="0" calcMode="spline" dur="1.5s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle></svg>
                    </div>
                </div>
                <div class="ml-auto">
                    <button class="flex items-center gap-x-2 p-1 px-2 rounded-md border border-gray-400 text-sm" :disabled="(formTextInput === null || formTextInput.trim() === '') && !form2.file">
                        <span :class="(formTextInput === null || formTextInput.trim() === '') && !form2.file ? 'text-slate-300' : 'text-black'">Send</span>
                        <div>
                            <svg v-if="!processingForm" :class="(formTextInput === null || formTextInput.trim() === '') && !form2.file ? 'text-slate-300' : 'text-black'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" d="M1.724 1.053a.5.5 0 0 0-.714.545l1.403 4.85a.5.5 0 0 0 .397.354l5.69.953c.268.053.268.437 0 .49l-5.69.953a.5.5 0 0 0-.397.354l-1.403 4.85a.5.5 0 0 0 .714.545l13-6.5a.5.5 0 0 0 0-.894l-13-6.5Z"/></svg>
                            <svg v-else xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="2" r="0" fill="currentColor"><animate attributeName="r" begin="0" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(45 12 12)"><animate attributeName="r" begin="0.125s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(90 12 12)"><animate attributeName="r" begin="0.25s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(135 12 12)"><animate attributeName="r" begin="0.375s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(180 12 12)"><animate attributeName="r" begin="0.5s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(225 12 12)"><animate attributeName="r" begin="0.625s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(270 12 12)"><animate attributeName="r" begin="0.75s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle><circle cx="12" cy="2" r="0" fill="currentColor" transform="rotate(315 12 12)"><animate attributeName="r" begin="0.875s" calcMode="spline" dur="1s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" repeatCount="indefinite" values="0;2;0;0"/></circle></svg>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </form>
</template>

ChatHeader Ui Code :

<script setup>
    import { ref, watchEffect, computed } from 'vue';
    import { router, useForm, Link, usePage } from '@inertiajs/vue3'
    import AlertModal from '@/Components/AlertModal.vue';
    import Dropdown from '@/Components/Dropdown.vue';
    import DropdownItemGroup from '@/Components/DropdownItemGroup.vue';
    import DropdownItem from '@/Components/DropdownItem.vue';
    import FormSelectCombo from '@/Components/FormSelectCombo.vue';
    import FormTextArea from '@/Components/FormTextArea.vue';
    import Modal from '@/Components/Modal.vue';
    import { trans } from 'laravel-vue-i18n';

    const props = defineProps(['contact', 'displayContactInfo', 'ticketingIsEnabled', 'ticket', 'addon']);

    const accountUser = computed(() => usePage().props.auth.user);
    const showAlert = ref(false);
    const displayContact = ref(props.displayContactInfo);
    const ticketState = ref(null);
    const isOpenModal = ref(false);
    const user = ref({ 
        'label' : props.ticket?.user ? props.ticket?.user?.full_name  : trans('Unassigned'),
        'value' : props.ticket?.user ? props.ticket?.user?.id  : 0, 
    });

    watchEffect(() => {
        displayContact.value = props.displayContactInfo;
        ticketState.value = props.ticket?.status;
    });

    const emit = defineEmits(['toggleView', 'deleteThread', 'closeThread']);

    const toggleView = () => {
        displayContact.value = !displayContact.value;
        emit('toggleView', displayContact.value);
    }

    const deleteThread = () => {
        router.visit('/chats/' + props.contact.uuid, {
            method: 'delete',
            onFinish: () => {
                showAlert.value = false
            }
        });
    }


    const form2 = useForm({
        'notes': null,
        'contact': null
    });

    const form3 = useForm({
        'ai_assistant': props.contact?.ai_assistance_enabled,
    });

    const changeTicketStatus = (value) => {
        router.put('/tickets/' + props.contact.uuid + '/update', {
            'status' : value
        }, {})
    }

    const changeTicketAgent = () => {
        router.put('/tickets/' + props.contact.uuid + '/assign', {
            'id' : user.value.value
        }, {})
    }

    function loadUsers(query, setOptions) {
        fetch("/team?search=" + query, {
                headers: {
                    'Accept': 'application/json' // Ensure that the request accepts JSON
                }
            })
            .then(response => response.json())
            .then(result => {
                setOptions(result.rows);
            })
            .catch(error => {
                console.error("Error fetching agents:", error);
            });
    }

    const submitForm = () => {
        form2.contact = props.contact.uuid;

        form2.post('/notes', {
            preserveState: false,
            onSuccess: () => {
                form2.reset();
                isOpenModal.value = false;
            }
        });
    }

    const submitForm3 = () => {
        form3.ai_assistant = !form3.ai_assistant;

        form3.post('/automation/contact/' + props.contact.uuid, {
            preserveState: true,
        });
    }
</script>
<template>
    <div class="h-20 bg-white border-b border-1 flex items-center justify-between px-4 md:px-4">
        <div class="flex items-center gap-x-4 cursor-pointer w-3/4">
            <Link href="/chats" class="sm:block md:hidden">
                <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><path fill="currentColor" d="M19 11H7.14l3.63-4.36a1 1 0 1 0-1.54-1.28l-5 6a1.19 1.19 0 0 0-.09.15c0 .05 0 .08-.07.13A1 1 0 0 0 4 12a1 1 0 0 0 .07.36c0 .05 0 .08.07.13a1.19 1.19 0 0 0 .09.15l5 6A1 1 0 0 0 10 19a1 1 0 0 0 .64-.23a1 1 0 0 0 .13-1.41L7.14 13H19a1 1 0 0 0 0-2"/></svg>
            </Link>
            <div @click="toggleView">
                <img v-if="contact.avatar" class="rounded-full w-14 h-14" :src="contact.avatar">
                <div v-else class="rounded-full w-10 h-10 flex items-center justify-center bg-slate-100">{{ contact.full_name.substring(0, 1) }}</div>
            </div>
            <div class="flex items-center w-full gap-x-8">
                <div>
                    <div class="flex items-center" @click="toggleView">
                        <span>{{ contact.full_name }}</span>
                    </div>
                    <div class="w-full flex items-center text-xs">
                        <span @click="toggleView">{{ contact.formatted_phone_number }}</span>
                    </div>
                </div>
                <FormSelectCombo v-if="ticketingIsEnabled && accountUser.teams[0]['role'] != 'agent'" v-model="user" :name="''" :loadOptions="loadUsers" :class="'col-span-1 md:block hidden'" :placeholder="'Select Agent'" @update:modelValue="changeTicketAgent()"/>
            </div>
        </div>
        <div>
            <div class="flex items-center space-x-4">
                <button v-if="ticketState === 'open' && ticketingIsEnabled" @click="changeTicketStatus('closed')" class="text-sm md:inline-flex hidden justify-center rounded-md border border-transparent bg-red-800 px-4 py-1 text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2">{{ $t('Mark as closed') }}</button>
                <button v-if="ticketState === 'closed' && ticketingIsEnabled" @click="changeTicketStatus('open')" class="text-sm md:inline-flex hidden justify-center rounded-md border border-transparent bg-primary px-4 py-1 text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2">{{ $t('Mark as open') }}</button>

                <Dropdown v-if="!displayContact">
                    <button type="button" class="inline-flex w-full justify-center items-center rounded-md text-sm font-medium text-black hover:bg-opacity-30 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75">
                        <span class="bg-slate-200 p-1 rounded-full cursor-pointer flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.75a.75.75 0 1 1 0-1.5a.75.75 0 0 1 0 1.5Zm0 6a.75.75 0 1 1 0-1.5a.75.75 0 0 1 0 1.5Zm0 6a.75.75 0 1 1 0-1.5a.75.75 0 0 1 0 1.5Z"/></svg>
                        </span>
                    </button>
                    <template #items>
                        <DropdownItemGroup>
                            <DropdownItem @click="isOpenModal = true;" as="button">{{ $t('Add notes') }}</DropdownItem>
                            <DropdownItem v-if="ticketState === 'open' && ticketingIsEnabled" @click="changeTicketStatus('closed')" as="button">{{ $t('Mark as closed') }}</DropdownItem>
                            <DropdownItem v-if="ticketState === 'closed' && ticketingIsEnabled" @click="changeTicketStatus('open')" as="button">{{ $t('Mark as open') }}</DropdownItem>
                            <DropdownItem @click="showAlert = true" as="button">{{ $t('Clear chat') }}</DropdownItem>
                        </DropdownItemGroup>
                    </template>
                </Dropdown>
                <div v-else @click="toggleView" class="bg-slate-200 p-2 rounded-lg text-sm cursor-pointer">
                    <span>{{ $t('Back') }}</span>
                </div>
            </div>
        </div>
    </div>
    <div v-if="addon == 1" class="flex justify-between items-center bg-white border-b border-1 py-2 px-4 md:px-4">
        <div class="text-sm py-1 px-3 rounded-md flex items-center gap-x-2 w-[fit-content]" :class="form3.ai_assistant ? 'bg-green-50' : 'bg-red-50'">
            <span :class="form3.ai_assistant ? 'text-green-500' : 'text-red-500'">
                <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24"><path fill="currentColor" d="M12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22"/></svg>
            </span>
            <span>{{ $t('AI Assistant') }}</span>
        </div>
        <div class="flex items-center gap-x-2">
            <span class="text-[13px]">{{ $t('Enable/disable AI assistant') }}</span>
            <div class="w-12 h-6 flex items-center bg-gray-300 rounded-full p-1 cursor-pointer" :class="{ 'bg-primary': form3.ai_assistant}" @click="submitForm3()">
                <div class="bg-white w-4 h-4 rounded-full shadow-md transform duration-300 ease-in-out" :class="{ 'translate-x-6': form3.ai_assistant }"></div>
            </div>
        </div>
    </div>

    <Modal :label="'Add Note'" :isOpen="isOpenModal">
        <div class="mt-5 grid grid-cols-1 gap-x-6 gap-y-4">
            <form @submit.prevent="submitForm()" class="">
                <FormTextArea v-model="form2.notes" :error="form2.errors.note" :name="''" :class="'col-span-2'"/>
                <div class="mt-4 flex">
                    <button type="button" @click.self="isOpenModal = false" class="inline-flex justify-center rounded-md border border-transparent bg-slate-50 px-4 py-2 text-sm text-slate-500 hover:bg-slate-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 mr-4">{{ $t('Cancel') }}</button>
                    <button 
                        :class="['inline-flex justify-center rounded-md border border-transparent bg-primary px-4 py-2 text-sm text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2', { 'opacity-50': form2.processing }]"
                        :disabled="form2.processing"
                    >
                        <svg v-if="form2.processing" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2A10 10 0 1 0 22 12A10 10 0 0 0 12 2Zm0 18a8 8 0 1 1 8-8A8 8 0 0 1 12 20Z" opacity=".5"/><path fill="currentColor" d="M20 12h2A10 10 0 0 0 12 2V4A8 8 0 0 1 20 12Z"><animateTransform attributeName="transform" dur="1s" from="0 12 12" repeatCount="indefinite" to="360 12 12" type="rotate"/></path></svg>
                        <span v-else>{{ $t('Save') }}</span>
                    </button>
                </div>
            </form>
        </div>
    </Modal>

    <AlertModal 
        v-model="showAlert" 
        :label="$t('Clear chat')" 
        :description="$t('Are you sure you want to delete this thread? You can\'t undo this action')" 
        @confirm="deleteThread" />
</template>

ChatTable Ui Code :



<script setup>
import { ref, watch } from 'vue';
import debounce from 'lodash/debounce';
import { Link, router } from "@inertiajs/vue3";
import Pagination from '@/Components/Pagination.vue';
import TicketStatusToggle from '@/Components/TicketStatusToggle.vue';
import SortDirectionToggle from '@/Components/SortDirectionToggle.vue';

const props = defineProps({
    rows: {
        type: Object,
        required: true,
    },
    filters: {
        type: Object
    },
    rowCount: {
        type: Number,
        required: true,
    },
    ticketingIsEnabled: {
        type: Boolean
    },
    status: {
        type: String,
    },
    chatSortDirection: {
        type: String
    }
});

const isSearching = ref(false);
const emit = defineEmits(['view']);

const contentType = (metadata) => {
    const chatData = JSON.parse(metadata);
    return chatData.type;
}

const content = (metadata) => {
    return JSON.parse(metadata);
}

const getExtension = (fileFormat) => {
    const formatMap = {
        'text/plain': 'TXT',
        'application/pdf': 'PDF',
        'application/vnd.ms-powerpoint': 'PPT',
        'application/msword': 'DOC',
        'application/vnd.ms-excel': 'XLS',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'DOCX',
        'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'PPTX',
        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'XLSX',
    };

    return formatMap[fileFormat] || 'Unknown';
};

const getContactDisplayName = (metadata) => {
    const contacts = JSON.parse(metadata).contacts;
    if (contacts.length === 1) {
        const contact = contacts[0];
        return contact.name.formatted_name || `${contact.name.first_name} ${contact.name.last_name}`;
    } else if (contacts.length > 1) {
        const firstName = contacts[0].name.first_name;
        const otherContactsCount = contacts.length - 1;
        return `${firstName} and ${otherContactsCount} other contacts`;
    } else {
        return 'No contacts available';
    }
}

const formatTime = (time) => {
    if (!time) {
        return "Invalid time";
    } else {
        const currentTime = new Date();
        const targetTime = new Date(time);

        // Check if the time is today
        if (
            targetTime.getDate() === currentTime.getDate() &&
            targetTime.getMonth() === currentTime.getMonth() &&
            targetTime.getFullYear() === currentTime.getFullYear()
        ) {
            return formatDate(targetTime, 'h:mm a');
        }

        // Check if the time is yesterday
        const yesterday = new Date();
        yesterday.setDate(currentTime.getDate() - 1);
        if (
            targetTime.getDate() === yesterday.getDate() &&
            targetTime.getMonth() === yesterday.getMonth() &&
            targetTime.getFullYear() === yesterday.getFullYear()
        ) {
            return 'Yesterday';
        }

        // If beyond yesterday, return the time in the format d/m/y
        return formatDate(targetTime, 'd/m/y');
    }
};

const formatDate = (date, format) => {
    let options = null;
    if (format === 'h:mm a') {
        options = { hour12: true, hour: 'numeric', minute: 'numeric' };
    } else {
        options = { day: 'numeric', month: 'numeric', year: 'numeric' };
    }

    return new Intl.DateTimeFormat('en-US', options).format(date);
};

const queryParamsString = window.location.search;

// Watch for changes in the query parameters
watch(() => queryParamsString,
    (newQuery, oldQuery) => {
        console.log('Query parameters changed:', newQuery);
        // Perform actions based on query parameter changes
    }
);

const params = ref({
    search: props.filters.search,
});

const search = debounce(() => {
    isSearching.value = true;
    runSearch();
}, 1000);

const runSearch = () => {
    const url = window.location.pathname;

    router.visit(url, {
        method: 'get',
        data: params.value,
    })
}

const clearSearch = () => {
    params.value.search = null;
    runSearch();
}
</script>


<script>
export default {
    data() {
        return {
            days: 2,
            customDays: null,
            loading: false,
        };
    },
    methods: {
        exportExcel() {
            let exportDays = this.days;
            if (this.days === 'custom') {
                if (!this.customDays || this.customDays < 1 || this.customDays > 30) {
                    alert('Please enter a number between 1 and 30');
                    return;
                }
                exportDays = this.customDays;
            }

            this.loading = true;

            // Build URL
            const url = `/chats?export=excel&days=${exportDays}`;
            window.location.href = url; // trigger download

            // Reset loading after a short delay (optional)
            setTimeout(() => { this.loading = false; }, 3000);
        }
    }
}
</script>


<template>
    <div class="px-4 py-4 border-b">
        <div class="flex items-center justify-between space-x-1 text-xl">
            <div class="flex space-x-1">
                <h2>{{ $t('Chats') }}</h2>
                <span class="text-slate-500">{{ rowCount }}</span>
            </div>
        </div>
        <div class="bg-slate-50 rounded-md mt-3 flex items-center py-[2px]">
            <div class="pl-3 py-2">
                <svg class="text-slate-600" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                    viewBox="0 0 24 24">
                    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" d="M3 10a7 7 0 1 0 14 0a7 7 0 1 0-14 0m18 11l-6-6" />
                </svg>
            </div>
            <input @input="search" v-model="params.search"
                class="w-full bg-slate-50 outline-none rounded-xl py-2 pl-2 mr-2 text-sm" type="text"
                :placeholder="$t('Search name or number...')">
            <button v-if="isSearching === false && params.search" @click="clearSearch" type="button" class="pr-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path fill="currentColor"
                        d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10s10-4.5 10-10S17.5 2 12 2zm3.7 12.3c.4.4.4 1 0 1.4c-.4.4-1 .4-1.4 0L12 13.4l-2.3 2.3c-.4.4-1 .4-1.4 0c-.4-.4-.4-1 0-1.4l2.3-2.3l-2.3-2.3c-.4-.4-.4-1 0-1.4c.4-.4 1-.4 1.4 0l2.3 2.3l2.3-2.3c.4-.4 1-.4 1.4 0c.4.4.4 1 0 1.4L13.4 12l2.3 2.3z" />
                </svg>
            </button>
            <span v-if="isSearching" class="pr-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0">
                        <animateTransform attributeName="transform" calcMode="discrete" dur="2.4s"
                            repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" />
                        <animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite"
                            values="1;1;0" />
                    </circle>
                    <circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0">
                        <animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s"
                            repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" />
                        <animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1"
                            repeatCount="indefinite" values="1;1;0" />
                    </circle>
                    <circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0">
                        <animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s"
                            repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" />
                        <animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1"
                            repeatCount="indefinite" values="1;1;0" />
                    </circle>
                </svg>
            </span>
        </div>

        <p class="mb-2 text-gray-600 text-sm">
            Here you can download <span class="font-medium">responded inbound chats</span> as an Excel file.
            Choose a time range (last 1 day, 2 days, or set a custom number of days up to 30), then click
            <b>Download</b>.
        </p>

        <!-- ✅ Button to download Excel -->
        <form @submit.prevent="exportExcel" ref="exportForm" class="flex items-center">
            <select v-model="days" ref="daysSelect"
                class="px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="1">Last 1 day</option>
                <option value="2">Last 2 days</option>
                <option value="custom">Custom</option>
            </select>

            <input type="number" v-if="days === 'custom'" v-model.number="customDays" min="1" max="30"
                class="ml-2 w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="Days" />

            <button
                class="ml-4 px-2 py-1 text-sm bg-blue-600 text-white rounded shadow hover:bg-blue-700 disabled:opacity-50"
                type="submit" :disabled="loading">
                {{ loading ? 'Downloading...' : 'Download' }}
            </button>
        </form>

        <div v-if="ticketingIsEnabled" class="grid grid-cols-2 mt-4 items-center w-full">
            <TicketStatusToggle :status="status" :rowCount="rowCount" />
            <div class="flex ml-auto gap-x-1">
                <SortDirectionToggle :direction="props.chatSortDirection" :url="'/chats/update-sort-direction'" />
            </div>
        </div>
    </div>
    <div class="flex-grow overflow-y-auto h-[65vh]" ref="scrollContainer">
        <Link :href="'/chats/' + contact.uuid + '?page=' + props.rows.meta.current_page"
            class="block border-b group-hover:pr-0" :class="contact.unread_messages > 0 ? 'bg-green-50' : ''"
            v-for="(contact, index) in rows.data" :key="index">
        <div class="flex space-x-2 hover:bg-gray-50 cursor-pointer py-3 px-4">
            <div class="w-[15%]">
                <img v-if="contact.avatar" class="rounded-full w-10 h-10" :src="contact.avatar">
                <div v-else class="rounded-full w-10 h-10 flex items-center justify-center bg-slate-200 capitalize">{{
                    contact.full_name.substring(0, 1) }}</div>
            </div>
            <div class="w-[85%]">
                <div class="flex justify-between">
                    <h3 class="truncate">{{ contact.full_name }}</h3>
                    <span class="self-center text-slate-500 text-xs">{{ formatTime(contact?.last_chat?.created_at)
                        }}</span>
                </div>
                <div v-if="contact?.last_chat?.deleted_at === null" class="flex justify-between">
                    <div v-if="contentType(contact?.last_chat?.metadata) === 'text'"
                        class="text-slate-500 text-xs truncate self-end"> {{
                            content(contact?.last_chat?.metadata).text.body }}</div>
                    <div v-if="contentType(contact?.last_chat?.metadata) === 'button'"
                        class="text-slate-500 text-xs truncate self-end"> {{
                            content(contact?.last_chat?.metadata).button.text }}</div>
                    <div v-if="contentType(contact?.last_chat?.metadata) === 'interactive'"
                        class="text-slate-500 text-xs truncate self-end"> {{
                            content(contact?.last_chat?.metadata).interactive?.button_reply?.title ||
                            content(contact?.last_chat?.metadata).interactive?.list_reply?.title }}</div>
                    <div v-if="contentType(contact?.last_chat?.metadata) === 'image'"
                        class="text-slate-500 text-xs truncate self-end">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                                <path fill="currentColor"
                                    d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.9 13.98l2.1 2.53l3.1-3.99c.2-.26.6-.26.8.01l3.51 4.68a.5.5 0 0 1-.4.8H6.02c-.42 0-.65-.48-.39-.81L8.12 14c.19-.26.57-.27.78-.02z" />
                            </svg>
                            <span class="ml-2">{{ $t('Photo') }}</span>
                        </div>
                    </div>
                    <div v-if="contentType(contact?.last_chat?.metadata) === 'document'"
                        class="text-slate-500 text-xs truncate self-end">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                                <path fill="currentColor" fill-rule="evenodd"
                                    d="M14.25 2.5a.25.25 0 0 0-.25-.25H7A2.75 2.75 0 0 0 4.25 5v14A2.75 2.75 0 0 0 7 21.75h10A2.75 2.75 0 0 0 19.75 19V9.147a.25.25 0 0 0-.25-.25H15a.75.75 0 0 1-.75-.75V2.5Zm.75 9.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1 0-1.5h6Zm0 4a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1 0-1.5h6Z"
                                    clip-rule="evenodd" />
                                <path fill="currentColor"
                                    d="M15.75 2.824c0-.184.193-.301.336-.186c.121.098.23.212.323.342l3.013 4.197c.068.096-.006.22-.124.22H16a.25.25 0 0 1-.25-.25V2.824Z" />
                            </svg>
                            <span class="ml-2">{{ getExtension(contact?.last_chat?.media.type) }} {{ $t('File')
                                }}</span>
                        </div>
                    </div>
                    <div v-if="contentType(contact?.last_chat?.metadata) === 'video'"
                        class="text-slate-500 text-xs truncate self-end">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                <path fill="currentColor"
                                    d="M3.5 2.5A2.5 2.5 0 0 0 1 5v6a2.5 2.5 0 0 0 2.5 2.5h5A2.5 2.5 0 0 0 11 11V5a2.5 2.5 0 0 0-2.5-2.5h-5Zm10.684 1.61L12 5.893v4.215l2.184 1.78a.5.5 0 0 0 .816-.389v-7a.5.5 0 0 0-.816-.387Z" />
                            </svg>
                            <span class="ml-2">{{ $t('Video') }}</span>
                        </div>
                    </div>
                    <div v-if="contentType(contact?.last_chat?.metadata) === 'audio'"
                        class="text-slate-500 text-xs truncate self-end">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 512">
                                <path fill="currentColor"
                                    d="M256 80C149.9 80 62.4 159.4 49.6 262c9.4-3.8 19.6-6 30.4-6c26.5 0 48 21.5 48 48v128c0 26.5-21.5 48-48 48c-44.2 0-80-35.8-80-80V288C0 146.6 114.6 32 256 32s256 114.6 256 256v112c0 44.2-35.8 80-80 80c-26.5 0-48-21.5-48-48V304c0-26.5 21.5-48 48-48c10.8 0 21 2.1 30.4 6C449.6 159.4 362.1 80 256 80z" />
                            </svg>
                            <span class="ml-2">{{ $t('Audio') }}</span>
                        </div>
                    </div>
                    <div v-if="contentType(contact?.last_chat?.metadata) === 'sticker'"
                        class="text-slate-500 text-xs truncate self-end">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256">
                                <path fill="currentColor"
                                    d="M168 32H88a56.06 56.06 0 0 0-56 56v80a56.06 56.06 0 0 0 56 56h48a8.07 8.07 0 0 0 2.53-.41c26.23-8.75 76.31-58.83 85.06-85.06A8.07 8.07 0 0 0 224 136V88a56.06 56.06 0 0 0-56-56Zm-32 175.42V176a40 40 0 0 1 40-40h31.42c-9.26 21.55-49.87 62.16-71.42 71.42Z" />
                            </svg>
                            <span class="ml-2">{{ $t('Sticker') }}</span>
                        </div>
                    </div>
                    <div v-if="contentType(contact?.last_chat?.metadata) === 'contacts'"
                        class="text-slate-500 text-xs truncate self-end">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                <path fill="currentColor"
                                    d="M3 14s-1 0-1-1s1-4 6-4s6 3 6 4s-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6a3 3 0 0 0 0 6Z" />
                            </svg>
                            <span class="ml-2">
                                {{ getContactDisplayName(contact?.last_chat?.metadata) }}
                            </span>
                        </div>
                    </div>
                    <div v-if="contentType(contact?.last_chat?.metadata) === 'location'"
                        class="text-slate-500 text-xs truncate self-end">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                                <path fill="currentColor"
                                    d="M9.156 14.544C10.899 13.01 14 9.876 14 7A6 6 0 0 0 2 7c0 2.876 3.1 6.01 4.844 7.544a1.736 1.736 0 0 0 2.312 0ZM6 7a2 2 0 1 1 4 0a2 2 0 0 1-4 0Z" />
                            </svg>
                            <span class="ml-2">{{ $t('Location') }}</span>
                        </div>
                    </div>
                    <span v-if="contact.unread_messages > 0"
                        class="bg-green-600 text-white rounded-md py-[1px] px-[8px] min-w-10 text-[10px] flex items-center justify-center">{{
                        contact.unread_messages }}</span>
                </div>
            </div>
        </div>
        </Link>
    </div>
    <div class="px-4 pb-4">
        <Pagination class="mt-3" :pagination="rows.meta" />
    </div>
</template>


ChatThread Ui Code :

<script setup>
import { ref } from 'vue';
import { default as axios } from 'axios';
import ChatBubble from '@/Components/ChatComponents/ChatBubble.vue';

const props = defineProps({
    contactId: {
        type: Number,
        required: true
    },
    initialMessages: {
        type: Array,
        required: true
    },
    hasMoreMessages: {
        type: Boolean,
        required: true
    },
    initialNextPage: {
        type: Number,
        required: true
    }
});

const messages = ref(props.initialMessages);
const loading = ref(false);
const nextPage = ref(props.initialNextPage);
const hasMore = ref(props.hasMoreMessages);

const loadMoreMessages = async () => {
    if (loading.value || !hasMore.value) return;

    loading.value = true;
    try {
        const response = await axios.get(`/chats/${props.contactId}/messages?page=${nextPage.value}`);
        messages.value = [...response.data.messages, ...messages.value];
        hasMore.value = response.data.hasMoreMessages;
        nextPage.value = response.data.nextPage;
    } catch (error) {
        console.error('Error loading messages:', error);
    } finally {
        loading.value = false;
    }
};
</script>

<template>
    <div class="py-4 md:py-4 relative px-6 md:px-10">
        <div v-if="hasMore" class="text-center py-2">
            <div v-if="loading"
                class="inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md text-sm text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25 transition ease-in-out duration-150">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-gray-700" xmlns="http://www.w3.org/2000/svg"
                    fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                    </path>
                </svg>
                Loading...
            </div>
            <button v-else @click="loadMoreMessages"
                class="inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md text-sm text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25 transition ease-in-out duration-150">
                <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                </svg>
                Load More Messages
            </button>
        </div>

        <div v-for="(chat, index) in messages" :key="index" class="flex flex-grow flex-col"
            :class="chat[0].type === 'ticket' ? 'justify-center' : 'justify-end'">
            <ChatBubble v-if="chat[0].type === 'chat'" :content="chat[0].value" :type="chat[0].value.type" />
            <div v-if="chat[0].type === 'ticket'" class="py-2">
                <div class="text-center font-light text-sm border-b border-t py-2 border-dashed border-black">
                    <div>{{ chat[0].value.description }} </div>
                    <div class="text-xs">{{ chat[0].value.created_at }}</div>
                </div>
            </div>
            <div v-if="chat[0].type === 'notes'" class="py-2 bg-orange-100 my-2 rounded-lg p-2 w-[fit-content] ml-auto">
                <div class="text-right font-light text-sm">
                    <div>{{ chat[0].value.content }}</div>
                    <div class="flex items-center justify-between mt-2 space-x-4">
                        <p class="text-gray-500 text-xs text-right leading-none">{{ chat[0].value.created_at }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

ContactInfo Ui Code :

<script setup>
    import { ref, watchEffect } from 'vue';
    import { Link, router } from '@inertiajs/vue3';
    import Dropdown from '@/Components/Dropdown.vue';
    import DropdownItemGroup from '@/Components/DropdownItemGroup.vue';
    import DropdownItem from '@/Components/DropdownItem.vue';
    import { trans } from 'laravel-vue-i18n';
    
    const props = defineProps(['contact', 'fields', 'locationSettings']);
    const contact = ref(props.contact);
    const metadata = (props.contact.metadata !== null && props.contact.metadata !== '') ? JSON.parse(props.contact.metadata) : {};

    watchEffect(() => {
        contact.value = props.contact;
    });

    const favorite = async() => {
        contact.value.is_favorite = !contact.value.is_favorite;

        router.put('/contacts/favorite/' + contact.value.uuid, { favorite: contact.value.is_favorite });
    }

    const deleteRow = async() => {
        router.visit('/contacts', {
            method: 'delete',
            data: { 'uuids': [ contact.value.uuid ]},
            preserveState: true
        })
    }

    const getAddressDetail = (value, key) => {
        const address = JSON.parse(value);
        return address?.[key] && address?.[key] != 'Not Set' ? address?.[key] : trans('not set');
    }
</script>
<template>
    <div class="px-20 overflow-y-scroll h-screen">
        <div class="flex justify-center space-x-8 items-center pb-6 pr-20 border-gray-300 border-b">
            <div>
                <div class="rounded-full p-1">
                    <img v-if="contact.avatar" class="rounded-full w-40 h-40" :src="contact.avatar">
                    <div v-else class="rounded-full w-40 h-40">
                        <svg class="text-gray-300" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path fill-rule="evenodd" d="M18.685 19.097A9.723 9.723 0 0021.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 003.065 7.097A9.716 9.716 0 0012 21.75a9.716 9.716 0 006.685-2.653zm-12.54-1.285A7.486 7.486 0 0112 15a7.486 7.486 0 015.855 2.812A8.224 8.224 0 0112 20.25a8.224 8.224 0 01-5.855-2.438zM15.75 9a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" clip-rule="evenodd" />
                        </svg>
                    </div>
                </div>
            </div>
            <div>
                <h1 class="text-3xl">{{ contact.full_name }}</h1>
                <div class="text-slate-500 truncate flex items-center">
                    <span class="text-sm">{{ contact.formatted_phone_number }}</span>
                </div>
                <div class="flex space-x-3 mt-4">
                    <button class="bg-gray-200 h-9 px-4 rounded-md flex items-center">
                        <Link :href="'/contacts/' + contact.uuid + '?edit=true'" class="text-[14px]">{{ $t('Edit') }}</Link>
                    </button>
                    <button class="bg-gray-200 h-9 px-4 rounded-md flex items-center">
                        <Link :href="'/chats/' + contact.uuid" class="text-[14px]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 256 256"><path fill="currentColor" d="M216 80h-32V48a16 16 0 0 0-16-16H40a16 16 0 0 0-16 16v128a8 8 0 0 0 13 6.22L72 154v30a16 16 0 0 0 16 16h93.59L219 230.22a8 8 0 0 0 5 1.78a8 8 0 0 0 8-8V96a16 16 0 0 0-16-16M66.55 137.78L40 159.25V48h128v88H71.58a8 8 0 0 0-5.03 1.78M216 207.25l-26.55-21.47a8 8 0 0 0-5-1.78H88v-32h80a16 16 0 0 0 16-16V96h32Z"></path></svg>
                        </Link>
                    </button>
                    <button @click="favorite()" class="bg-gray-200 h-9 px-4 rounded-md">
                        <svg v-if="contact.is_favorite === 0 || contact.is_favorite === false" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-width="1.5" d="M9.153 5.408C10.42 3.136 11.053 2 12 2c.947 0 1.58 1.136 2.847 3.408l.328.588c.36.646.54.969.82 1.182c.28.213.63.292 1.33.45l.636.144c2.46.557 3.689.835 3.982 1.776c.292.94-.546 1.921-2.223 3.882l-.434.507c-.476.557-.715.836-.822 1.18c-.107.345-.071.717.001 1.46l.066.677c.253 2.617.38 3.925-.386 4.506c-.766.582-1.918.051-4.22-1.009l-.597-.274c-.654-.302-.981-.452-1.328-.452c-.347 0-.674.15-1.329.452l-.595.274c-2.303 1.06-3.455 1.59-4.22 1.01c-.767-.582-.64-1.89-.387-4.507l.066-.676c.072-.744.108-1.116 0-1.46c-.106-.345-.345-.624-.821-1.18l-.434-.508c-1.677-1.96-2.515-2.941-2.223-3.882c.293-.941 1.523-1.22 3.983-1.776l.636-.144c.699-.158 1.048-.237 1.329-.45c.28-.213.46-.536.82-1.182l.328-.588Z"/></svg>
                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#031b4d" stroke="#031b4d" stroke-width="1.5" d="M9.153 5.408C10.42 3.136 11.053 2 12 2c.947 0 1.58 1.136 2.847 3.408l.328.588c.36.646.54.969.82 1.182c.28.213.63.292 1.33.45l.636.144c2.46.557 3.689.835 3.982 1.776c.292.94-.546 1.921-2.223 3.882l-.434.507c-.476.557-.715.836-.822 1.18c-.107.345-.071.717.001 1.46l.066.677c.253 2.617.38 3.925-.386 4.506c-.766.582-1.918.051-4.22-1.009l-.597-.274c-.654-.302-.981-.452-1.328-.452c-.347 0-.674.15-1.329.452l-.595.274c-2.303 1.06-3.455 1.59-4.22 1.01c-.767-.582-.64-1.89-.387-4.507l.066-.676c.072-.744.108-1.116 0-1.46c-.106-.345-.345-.624-.821-1.18l-.434-.508c-1.677-1.96-2.515-2.941-2.223-3.882c.293-.941 1.523-1.22 3.983-1.776l.636-.144c.699-.158 1.048-.237 1.329-.45c.28-.213.46-.536.82-1.182l.328-.588Z"/></svg>
                    </button>
                    <Dropdown class="h-100" :align="'right'">
                        <button class="h-9 bg-gray-200 py-2 px-3 rounded-md flex items-center">
                            <span class="">
                                <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 16 16"><path fill="currentColor" d="M4 8a2 2 0 1 1-4 0a2 2 0 0 1 4 0Zm6 0a2 2 0 1 1-4 0a2 2 0 0 1 4 0Zm4 2a2 2 0 1 0 0-4a2 2 0 0 0 0 4Z"/></svg>
                            </span>
                        </button>
                        <template #items>
                            <DropdownItemGroup>
                                <DropdownItem as="button" @click="deleteRow()">{{ $t('Delete') }}</DropdownItem>
                            </DropdownItemGroup>
                        </template>
                    </Dropdown>
                </div>
            </div>
        </div>
        <div class="pr-20 border-gray-300 border-b py-4">
            <div class="grid grid-cols-2 space-x-8 text-[14px]">
                <div class="text-right text-slate-500 pb-2">
                    <span>{{ $t('Full name') }}</span>
                </div>
                <div>
                    <span>{{ contact.full_name }}</span>
                </div>
                <div class="text-right text-slate-500 pb-2">
                    <span>{{ $t('Group') }}</span>
                </div>
                <div>
                    <span class="">
                        {{ contact.contact_groups?.length ? contact.contact_groups.map(group => group.name).join(', ') : $t('not set') }}
                    </span>
                </div>
                <div class="text-right text-slate-500 pb-2">
                    <span>{{ $t('Email') }}</span>
                </div>
                <div>
                    <span>{{ contact.email ?? $t('not set') }}</span>
                </div>
                <div class="text-right text-slate-500 pb-2">
                    <span>{{ $t('Contact') }}</span>
                </div>
                <div>
                    <span>{{ contact.formatted_phone_number }}</span>
                </div>
            </div>
        </div>
        <div v-if="locationSettings === 'before' && fields.length > 0" class="pr-20 border-gray-300 border-b py-4">
            <div v-for="(input, index) in props.fields" class="grid grid-cols-2 space-x-8 text-[14px]">
                <div class="text-right text-slate-500 pb-2">
                    <span>{{ $t(input.name) }}</span>
                </div>
                <div>
                    <span v-if="metadata && metadata[input.name] != null">{{ metadata[input.name] }}</span>
                    <span v-else class="p-1 bg-slate-100 text-xs rounded-md text-gray-600">{{ $t('not set') }}</span>
                </div>
            </div>
        </div>
        <div class="pr-20 py-4">
            <div class="grid grid-cols-2 space-x-8 text-[14px]">
                <div class="text-right text-slate-500 pb-2">
                    <span>{{ $t('Street') }}</span>
                </div>
                <div>
                    <span>{{ getAddressDetail(contact.address, 'street') }}</span>
                </div>
                <div class="text-right text-slate-500 pb-2">
                    <span>{{ $t('City') }}</span>
                </div>
                <div>
                    <span>{{ getAddressDetail(contact.address, 'city') }}</span>
                </div>
                <div class="text-right text-slate-500 pb-2">
                    <span>{{ $t('State') }}</span>
                </div>
                <div>
                    <span>{{ getAddressDetail(contact.address, 'state') }}</span>
                </div>
                <div class="text-right text-slate-500 pb-2">
                    <span>{{ $t('Zip code') }}</span>
                </div>
                <div>
                    <span>{{ getAddressDetail(contact.address, 'zip') }}</span>
                </div>
                <div class="text-right text-slate-500 pb-2">
                    <span>{{ $t('Country') }}</span>
                </div>
                <div>
                    <span>{{ getAddressDetail(contact.address, 'country') }}</span>
                </div>
            </div>
        </div>
        <div v-if="locationSettings === 'after' && fields.length > 0" class="pr-20 border-gray-300 border-t py-4">
            <div v-for="(input, index) in props.fields" class="grid grid-cols-2 space-x-8 text-[14px]">
                <div class="text-right text-slate-500 pb-2">
                    <span>{{ $t(input.name) }}</span>
                </div>
                <div>
                    <span v-if="metadata && metadata[input.name] != null">{{ metadata[input.name] }}</span>
                    <span v-else class="p-1 bg-slate-100 text-xs rounded-md text-gray-600">{{ $t('not set') }}</span>
                </div>
            </div>
        </div>
    </div>
</template>